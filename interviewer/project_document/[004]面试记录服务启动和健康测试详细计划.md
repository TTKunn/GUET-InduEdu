# [004]面试记录服务启动和健康测试详细计划

## 📋 任务概述
启动面试记录服务并进行基本健康测试，确保服务正常运行并可供Dify工作流调用。

## 🎯 任务目标
1. 成功启动面试记录服务 (端口8006)
2. 验证服务健康状态
3. 确认API接口可访问
4. 验证数据库连接正常

## 📝 详细执行计划

### 步骤1: 启动面试记录服务
**执行命令**: `python start_server.py`
**预期结果**: 
- 服务在端口8006启动成功
- 显示启动信息和API接口列表
- 无错误日志输出

**验收标准**:
- [ ] 控制台显示"🚀 启动interview-service HTTP服务..."
- [ ] 显示服务地址: http://localhost:8006
- [ ] 显示API文档地址: http://localhost:8006/docs
- [ ] 显示健康检查地址: http://localhost:8006/health
- [ ] 显示Dify专用API接口列表
- [ ] 无异常错误信息

### 步骤2: 验证服务健康状态
**执行方式**: 访问健康检查接口
**测试接口**: `GET http://localhost:8006/health`
**预期响应**:
```json
{
  "status": "healthy",
  "timestamp": "2025-01-XX...",
  "database_connected": true,
  "external_services": {
    "analysis_service": "unavailable"
  },
  "stats": {
    "service_name": "interview-service",
    "port": 8006,
    "database_status": "connected"
  }
}
```

**验收标准**:
- [ ] HTTP状态码: 200
- [ ] status字段: "healthy"
- [ ] database_connected: true
- [ ] 返回完整的服务状态信息

### 步骤3: 验证API文档可访问
**执行方式**: 访问Swagger文档
**测试地址**: `http://localhost:8006/docs`
**预期结果**: 
- 显示完整的FastAPI自动生成文档
- 包含所有API接口定义
- 可以查看接口参数和响应模型

**验收标准**:
- [ ] 页面正常加载
- [ ] 显示"面试记录服务"标题
- [ ] 包含Dify专用API接口组
- [ ] 包含标准API接口组
- [ ] 接口文档完整可读

### 步骤4: 验证根路径接口
**执行方式**: 访问根路径
**测试接口**: `GET http://localhost:8006/`
**预期响应**:
```json
{
  "service": "面试记录服务",
  "version": "1.0.0",
  "status": "running",
  "timestamp": "2025-01-XX...",
  "docs": "/docs",
  "health": "/health",
  "dify_apis": {
    "create_interview": "/dify/interview/create",
    "add_qa": "/dify/interview/add-qa",
    "latest_interview": "/dify/interview/{user_id}/latest",
    "interview_summary": "/dify/interview/{session_id}/summary"
  }
}
```

**验收标准**:
- [ ] HTTP状态码: 200
- [ ] 返回服务基本信息
- [ ] 包含版本号和状态
- [ ] 包含API接口路径说明

### 步骤5: 验证数据库连接状态
**执行方式**: 通过健康检查接口确认
**验证点**:
- database_connected字段为true
- database_status为"connected"
- 无数据库连接错误日志

**验收标准**:
- [ ] 数据库连接状态正常
- [ ] 无MySQL连接错误
- [ ] 数据库表结构完整

## 🔧 故障排除预案

### 问题1: 服务启动失败
**可能原因**: 端口被占用、依赖包缺失
**解决方案**: 
1. 检查端口占用: `netstat -an | findstr :8006`
2. 重新安装依赖: `pip install -r requirements.txt`

### 问题2: 数据库连接失败
**可能原因**: 网络问题、认证失败
**解决方案**:
1. 检查网络连通性
2. 验证数据库配置
3. 查看详细错误日志

### 问题3: 健康检查失败
**可能原因**: 服务未完全启动
**解决方案**:
1. 等待服务完全启动
2. 检查启动日志
3. 重新启动服务

## 📊 完成标准
- [x] 调查阶段: 环境验证完成
- [ ] 执行阶段: 服务启动成功
- [ ] 执行阶段: 健康检查通过
- [ ] 执行阶段: API文档可访问
- [ ] 执行阶段: 根路径接口正常
- [ ] 审查阶段: 服务状态确认

## 📝 备注
- 功能测试由用户使用Apifox进行
- 本计划仅覆盖基本启动和健康测试
- 外部服务analysis-service状态为"unavailable"属正常情况
- 服务启动后保持运行状态供后续测试使用

---
**创建时间**: 2025-01-04
**最后更新**: 2025-01-04
**状态**: 待执行
