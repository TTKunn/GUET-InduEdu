# [012]简历分析服务字段扩展详细计划

## 项目概述
为了提供更全面的简历信息提取和分析能力，对简历分析服务进行字段扩展，新增8个数据库字段，实现更详细的候选人信息收集，为Dify工作流提供更丰富的上下文信息。

## 扩展目标
- 新增8个数据库字段，提升简历信息提取的完整性
- 保持现有存储逻辑不变，确保向后兼容
- 为Dify工作流提供更详细的面试题目生成依据
- 实现结构化数据和详细描述的分离存储

## 新增字段详解

### 1. 个人基本信息字段（4个）
- **gender** (String): 性别
- **age** (Integer): 年龄
- **ethnicity** (String): 民族
- **political_status** (String): 政治面貌

### 2. 教育信息字段（2个）
- **university** (String): 院校
- **major** (String): 专业

### 3. 详细经验字段（2个JSON格式）
- **work_experience_detail_json** (Text): 工作经验详细内容JSON存储
- **project_experience_detail_json** (Text): 项目经验详细内容JSON存储

## 技术实现方案

### 数据库层面修改
1. **mysql_models.py** - 更新CandidateProfile模型
   - 添加8个新字段定义
   - 设置合适的数据类型和约束

2. **mysql_client.py** - 更新数据库操作逻辑
   - 修改_create_profile方法支持新字段
   - 修改_update_profile方法支持新字段
   - 修改get_profile方法返回新字段

### API层面修改
1. **models.py** - 更新数据模型
   - 扩展PersonalInfo模型包含新的个人信息字段
   - 扩展CandidateProfile模型包含详细经验字段

2. **main.py** - 更新业务逻辑
   - 修改档案构建逻辑，填充新字段数据

### LLM提取层面修改
1. **llm_service.py** - 增强提取能力
   - 更新提取prompt，包含新字段要求
   - 修改默认数据结构，支持新字段
   - 强化详细经验字段的提取逻辑

## 字段格式说明

### 详细经验字段格式
```json
{
  "work_experience_detail": [
    {
      "title": "工作经验标题（如：高级后端开发工程师 - 腾讯科技）",
      "content": "工作经验详细描述，包括具体职责、技术栈、项目成果等"
    }
  ],
  "project_experience_detail": [
    {
      "title": "项目经验标题（如：分布式电商系统）",
      "content": "项目经验详细描述，包括技术架构、解决方案、技术挑战等"
    }
  ]
}
```

### 个人信息字段格式
```json
{
  "personal_info": {
    "name": "姓名",
    "phone": "电话号码",
    "email": "邮箱地址",
    "location": "所在地",
    "age": 25,
    "gender": "性别",
    "ethnicity": "民族",
    "political_status": "政治面貌",
    "university": "院校",
    "major": "专业"
  }
}
```

## API返回格式对比

### 扩展前
```json
{
  "personal_info": {
    "name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "location": "北京市"
  },
  "work_experience_detail": [],
  "project_experience_detail": []
}
```

### 扩展后
```json
{
  "personal_info": {
    "name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "location": "北京市",
    "age": 25,
    "gender": "男",
    "ethnicity": "汉族",
    "political_status": "共青团员",
    "university": "清华大学",
    "major": "计算机科学与技术"
  },
  "work_experience_detail": [
    {
      "title": "高级后端开发工程师 - 腾讯科技",
      "content": "负责微服务架构设计与实现，使用Spring Boot开发高并发系统..."
    }
  ],
  "project_experience_detail": [
    {
      "title": "分布式电商系统",
      "content": "基于Spring Cloud微服务架构，实现了用户管理、订单处理、支付系统等核心功能..."
    }
  ]
}
```

## 字段含义解析

### 基础信息字段
- **personal_info**: 个人基本信息（包含新增的8个字段）
- **education/work_experience/projects**: 结构化数据

### 关键词字段（用于Dify工作流）
- **technical_skills**: 技术技能关键词列表
- **projects_keywords**: 项目关键词信息（name + keywords格式）
- **direction**: 技术方向

### 详细经验字段（新增重点）
- **work_experience_detail**: 工作经验详细描述（title + content格式）
- **project_experience_detail**: 项目经验详细描述（title + content格式）

### 兼容性字段
- **extracted_keywords/technical_keywords/domain_keywords**: 向后兼容

## 实施效果

### 功能优势
- **信息完整性**: 新增字段提供更全面的候选人信息
- **面试定制化**: 详细经验字段为Dify工作流提供丰富的上下文
- **向后兼容**: 保持现有存储逻辑不变，不影响原有字段
- **数据结构清晰**: 区分关键词字段和详细描述字段，满足不同使用场景

### 测试验证
- ✅ 新字段成功提取和存储
- ✅ 详细经验字段包含完整的项目描述
- ✅ 个人信息字段正确识别院校和专业
- ✅ 数据库存储和读取功能正常
- ✅ API接口返回格式正确

## 使用指南

### 调用示例
```bash
curl -X POST "http://43.142.157.145:8004/analyze" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "user_id=test_user" \
  -F "file=@/path/to/resume.pdf" \
  -F "extraction_mode=comprehensive" \
  -F "overwrite=true"
```

### 返回数据使用
- **面试题目生成**: 使用project_experience_detail中的详细描述
- **候选人画像**: 使用personal_info中的完整信息
- **技能匹配**: 使用technical_skills关键词列表
- **项目经验评估**: 结合projects_keywords和project_experience_detail

## 项目状态
- **开发状态**: ✅ 已完成
- **测试状态**: ✅ 已验证
- **部署状态**: ✅ 已部署
- **文档状态**: ✅ 已更新

---

**完成时间**: 2025-09-23  
**负责人**: AI Assistant  
**版本**: v1.2.0
