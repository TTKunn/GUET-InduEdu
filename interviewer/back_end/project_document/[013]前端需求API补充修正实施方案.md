# [013]å‰ç«¯éœ€æ±‚APIè¡¥å……ä¿®æ­£å®æ–½æ–¹æ¡ˆ

**æ–‡æ¡£ç¼–å·**: 013  
**æ–‡æ¡£ç±»å‹**: é˜¶æ®µæ€§æ–‡æ¡£ - å®æ–½æ–¹æ¡ˆ  
**åˆ›å»ºæ—¶é—´**: 2025-10-31  
**æœ€åæ›´æ–°**: 2025-10-31  
**é¡¹ç›®åç§°**: GUET-InduEdu AIæ™ºèƒ½é¢è¯•å®˜ç³»ç»Ÿ  
**é¡¹ç›®è·¯å¾„**: `/home/ubuntu/workspace/project/GUET-InduEdu/interviewer/back_end/`

---

## ğŸ“‘ ç›®å½•

1. [éœ€æ±‚èƒŒæ™¯](#éœ€æ±‚èƒŒæ™¯)
2. [éœ€æ±‚åˆ†æ](#éœ€æ±‚åˆ†æ)
3. [æ•°æ®åº“ç°çŠ¶ç¡®è®¤](#æ•°æ®åº“ç°çŠ¶ç¡®è®¤)
4. [ä»£ç å®æ–½æ–¹æ¡ˆ](#ä»£ç å®æ–½æ–¹æ¡ˆ)
5. [æ–‡æ¡£æ›´æ–°æ–¹æ¡ˆ](#æ–‡æ¡£æ›´æ–°æ–¹æ¡ˆ)
6. [æµ‹è¯•éªŒè¯æ–¹æ¡ˆ](#æµ‹è¯•éªŒè¯æ–¹æ¡ˆ)
7. [Difyå·¥ä½œæµé…ç½®è¯´æ˜](#difyå·¥ä½œæµé…ç½®è¯´æ˜)
8. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
9. [å®æ–½æ­¥éª¤æ¸…å•](#å®æ–½æ­¥éª¤æ¸…å•)
10. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## éœ€æ±‚èƒŒæ™¯

### ä¸šåŠ¡èƒŒæ™¯
å‰ç«¯å¼€å‘å›¢é˜Ÿåœ¨å¯¹æ¥é¢è¯•è®°å½•æœåŠ¡APIæ—¶ï¼Œå‘ç°åˆ›å»ºé¢è¯•ä¼šè¯æ¥å£è¿”å›çš„æ•°æ®ä¸å®Œæ•´ï¼Œç¼ºå°‘å‰ç«¯é¡µé¢æ¸²æŸ“æ‰€éœ€çš„å…³é”®å­—æ®µï¼Œå¯¼è‡´å‰ç«¯æ— æ³•æ­£ç¡®æ˜¾ç¤ºé¢è¯•ä¼šè¯ä¿¡æ¯ã€‚

### æ ¸å¿ƒé—®é¢˜
1. **åˆ›å»ºä¼šè¯æ¥å£è¿”å›ä¸å®Œæ•´**ï¼šç¼ºå°‘ `session_type`ã€`difficulty_level`ã€`estimated_duration`ã€`total_questions` å››ä¸ªå­—æ®µ
2. **ä¼šè¯è¯¦æƒ…æ¥å£æ–‡æ¡£ç¼ºå¤±**ï¼šæ¥å£å·²å®ç°ä½†æ–‡æ¡£ä¸å®Œæ•´ï¼Œå‰ç«¯ä¸çŸ¥é“å¦‚ä½•è°ƒç”¨
3. **ä¸šåŠ¡é€»è¾‘ä¸æ¸…æ™°**ï¼šé¢˜ç›®æ•°é‡(`total_questions`)çš„æ¥æºå’Œä¼ é€’æ–¹å¼ä¸æ˜ç¡®

### ä¸šåŠ¡æµç¨‹ç¡®è®¤
```
1. ç”¨æˆ·åœ¨å‰ç«¯é€‰æ‹© â†’ é¢˜ç›®æ•°é‡(10/15/20é¢˜)ã€éš¾åº¦(easy/medium/hard)ã€é¢è¯•ç±»å‹
2. å‰ç«¯è°ƒç”¨åç«¯ â†’ POST /dify/interview/create (æºå¸¦ç”¨æˆ·é€‰æ‹©çš„å‚æ•°)
3. åç«¯ä¿å­˜ä¼šè¯ â†’ å°† total_questions å­˜å…¥æ•°æ®åº“
4. åç«¯è¿”å›å®Œæ•´ä¿¡æ¯ â†’ åŒ…å« total_questions ç­‰æ‰€æœ‰å­—æ®µ
5. å‰ç«¯è°ƒç”¨Difyå·¥ä½œæµ â†’ ä¼ å…¥ session_id å’Œ total_questions
6. Difyå·¥ä½œæµæ‰§è¡Œ â†’ ä½¿ç”¨ total_questions æ§åˆ¶å¾ªç¯ç”Ÿæˆé¢˜ç›®æ¬¡æ•°
```

**å…³é”®ç‚¹**ï¼š`total_questions` ç”±å‰ç«¯ç”¨æˆ·æŒ‡å®šï¼Œåç«¯åªè´Ÿè´£æ¥æ”¶ã€ä¿å­˜ã€è½¬å‘ï¼Œä¸è¿›è¡Œè®¡ç®—ã€‚

---

## éœ€æ±‚åˆ†æ

### P0çº§åˆ«éœ€æ±‚ï¼ˆå¿…é¡»å®ç°ï¼‰â­â­â­

#### 1. ä¿®æ”¹åˆ›å»ºä¼šè¯APIè¿”å›å®Œæ•´æ•°æ®

**æ¥å£**: `POST /dify/interview/create`

**å½“å‰è¿”å›ï¼ˆä¸å®Œæ•´ï¼‰**:
```json
{
  "success": true,
  "session_id": "session_xxx",
  "user_id": "user_001",
  "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
  "status": "created",
  "created_at": "2025-09-05T21:10:46"
}
```

**åº”è¯¥è¿”å›ï¼ˆå®Œæ•´ï¼‰**:
```json
{
  "success": true,
  "session_id": "session_xxx",
  "user_id": "user_001",
  "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
  "session_type": "resume_customized",      // â† æ–°å¢
  "difficulty_level": "medium",             // â† æ–°å¢
  "estimated_duration": 45,                 // â† æ–°å¢
  "total_questions": 15,                    // â† æ–°å¢
  "status": "created",
  "created_at": "2025-09-05T21:10:46",
  "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
}
```

#### 2. å®Œå–„ä¼šè¯è¯¦æƒ…æŸ¥è¯¢APIæ–‡æ¡£

**æ¥å£**: `GET /interview/sessions/{session_id}/detail`

**åŠŸèƒ½**: è·å–é¢è¯•ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯

**è¿”å›æ ¼å¼**:
```json
{
  "success": true,
  "session": {
    "session_id": "session_xxx",
    "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "estimated_duration": 45,
    "total_questions": 15,
    "status": "created",
    "created_at": "2025-10-30T10:00:00",
    "question_count": 0,
    "average_score": null
  },
  "message": "è·å–é¢è¯•ä¼šè¯è¯¦æƒ…æˆåŠŸ"
}
```

#### 3. åŒæ­¥APIæ–‡æ¡£

éœ€è¦æ›´æ–°ä»¥ä¸‹æ–‡æ¡£ï¼š
- `[000]APIæ¥å£æ–‡æ¡£.md`
- `[000]é¡¹ç›®å®Œæ•´æŒ‡å—ï¼ˆå«apiï¼‰.md`

---

## æ•°æ®åº“ç°çŠ¶ç¡®è®¤

### æ•°æ®åº“è¡¨: `interview_sessions`

**æ•°æ®åº“**: `interview_analysis`  
**è¡¨å**: `interview_sessions`

#### å­—æ®µç°çŠ¶ï¼ˆå·²é€šè¿‡MySQLæŸ¥è¯¢éªŒè¯ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å­˜åœ¨ | å½“å‰é»˜è®¤å€¼ | è¯´æ˜ |
|--------|----------|----------|------------|------|
| estimated_duration | INT | âœ… å·²å­˜åœ¨ | 60 | é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| total_questions | INT | âœ… å·²å­˜åœ¨ | 0 | é¢˜ç›®æ€»æ•° |

**éªŒè¯ç»“æœ**:
```sql
-- æŸ¥è¯¢ç»“æœï¼ˆ2025-10-31éªŒè¯ï¼‰
Field                Type          Null  Key  Default  Extra
estimated_duration   int           YES        60       
total_questions      int           YES        0
```

#### ç»“è®º

âœ… **æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´ï¼Œæ— éœ€æ‰§è¡Œ ALTER TABLE è¯­å¥**

âš ï¸ **æ³¨æ„**ï¼š
- `estimated_duration` é»˜è®¤å€¼ä¸º 60 åˆ†é’Ÿï¼ˆå¯èƒ½éœ€è¦ä¸šåŠ¡å±‚è°ƒæ•´ä¸º 45ï¼‰
- `total_questions` é»˜è®¤å€¼ä¸º 0ï¼ˆç”±äºå‰ç«¯å¿…ä¼ ï¼Œé»˜è®¤å€¼ä¸é‡è¦ï¼‰

#### å¯é€‰æ“ä½œï¼ˆå¦‚éœ€ä¿®æ”¹é»˜è®¤å€¼ï¼‰

```sql
-- å¯é€‰ï¼šä¿®æ”¹é»˜è®¤å€¼ä»¥åŒ¹é…ä¸šåŠ¡é€»è¾‘
ALTER TABLE interview_sessions 
MODIFY COLUMN estimated_duration INT DEFAULT 45 COMMENT 'é¢„è®¡æ—¶é•¿(åˆ†é’Ÿ)';

ALTER TABLE interview_sessions 
MODIFY COLUMN total_questions INT DEFAULT 15 COMMENT 'é¢˜ç›®æ€»æ•°';
```

**å»ºè®®**: ä¸ä¿®æ”¹æ•°æ®åº“é»˜è®¤å€¼ï¼Œåœ¨ä»£ç å±‚é¢å¤„ç†ï¼ˆæ›´çµæ´»ï¼‰ã€‚

---

## ä»£ç å®æ–½æ–¹æ¡ˆ

### æ¶‰åŠæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è·¯å¾„ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| models.py | interview-service/models.py | ä¿®æ”¹è¯·æ±‚/å“åº”æ¨¡å‹ | P0 |
| interview_service.py | interview-service/interview_service.py | ä¿®æ”¹ä¸šåŠ¡é€»è¾‘æ–¹æ³• | P0 |
| database.py | interview-service/database.py | ä¼ é€’å‚æ•°ï¼ˆå·²æ”¯æŒï¼‰ | P0 |
| main.py | interview-service/main.py | ä¼ é€’æ–°å¢å‚æ•° | P0 |

### ä¿®æ”¹è¯¦æƒ…

#### 1. models.py - ä¿®æ”¹è¯·æ±‚æ¨¡å‹

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/models.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬129-134è¡Œ

**å½“å‰ä»£ç **:
```python
class DifyCreateInterviewRequest(BaseModel):
    """Difyåˆ›å»ºé¢è¯•è®°å½•è¯·æ±‚"""
    user_id: str = Field(..., description="ç”¨æˆ·ID")
    session_name: Optional[str] = Field(None, description="é¢è¯•åç§°ï¼ˆå¯é€‰ï¼‰")
    session_type: SessionType = Field(..., description="é¢è¯•ç±»å‹ï¼ˆå¿…å¡«ï¼‰")
    difficulty_level: DifficultyLevel = Field(..., description="é¢è¯•éš¾åº¦ï¼ˆå¿…å¡«ï¼‰")
```

**ä¿®æ”¹ä¸º**:
```python
class DifyCreateInterviewRequest(BaseModel):
    """Difyåˆ›å»ºé¢è¯•è®°å½•è¯·æ±‚"""
    user_id: str = Field(..., description="ç”¨æˆ·ID")
    session_name: Optional[str] = Field(None, description="é¢è¯•åç§°ï¼ˆå¯é€‰ï¼‰")
    session_type: SessionType = Field(..., description="é¢è¯•ç±»å‹ï¼ˆå¿…å¡«ï¼‰")
    difficulty_level: DifficultyLevel = Field(..., description="é¢è¯•éš¾åº¦ï¼ˆå¿…å¡«ï¼‰")
    total_questions: int = Field(..., ge=5, le=30, description="é¢˜ç›®æ€»æ•°ï¼ˆå‰ç«¯ç”¨æˆ·æŒ‡å®šï¼Œå¿…å¡«ï¼‰")  # â† æ–°å¢
    estimated_duration: Optional[int] = Field(None, ge=10, le=180, description="é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œå¯é€‰")  # â† æ–°å¢
```

**ä¿®æ”¹è¯´æ˜**:
- `total_questions`: å¿…å¡«å­—æ®µï¼Œç”±å‰ç«¯ç”¨æˆ·åœ¨ç•Œé¢é€‰æ‹©ï¼ŒèŒƒå›´5-30é¢˜
- `estimated_duration`: å¯é€‰å­—æ®µï¼Œå¦‚ä¸ä¼ åˆ™åç«¯æ ¹æ®é¢˜ç›®æ•°é‡è‡ªåŠ¨è®¡ç®—

---

#### 2. models.py - ä¿®æ”¹å“åº”æ¨¡å‹

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/models.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬148-156è¡Œ

**å½“å‰ä»£ç **:
```python
class DifyCreateInterviewResponse(BaseModel):
    """Difyåˆ›å»ºé¢è¯•è®°å½•å“åº”"""
    success: bool
    session_id: str
    user_id: str
    session_name: str
    status: str
    created_at: str
    message: str
```

**ä¿®æ”¹ä¸º**:
```python
class DifyCreateInterviewResponse(BaseModel):
    """Difyåˆ›å»ºé¢è¯•è®°å½•å“åº”"""
    success: bool
    session_id: str
    user_id: str
    session_name: str
    session_type: str          # â† æ–°å¢
    difficulty_level: str      # â† æ–°å¢
    estimated_duration: int    # â† æ–°å¢
    total_questions: int       # â† æ–°å¢
    status: str
    created_at: str
    message: str
```

---

#### 3. interview_service.py - ä¿®æ”¹ä¸šåŠ¡é€»è¾‘

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/interview_service.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬37-78è¡Œ

**å½“å‰ä»£ç **:
```python
def dify_create_interview(self, user_id: str, session_name: Optional[str] = None, 
                         session_type: str = "technical",
                         difficulty_level: str = "medium") -> Optional[Dict[str, Any]]:
    """Difyä¸“ç”¨ï¼šåˆ›å»ºé¢è¯•è®°å½•"""
    try:
        # å¦‚æœæ²¡æœ‰æä¾›session_nameï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤åç§°
        if not session_name:
            from datetime import datetime
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            session_name = f"é¢è¯•_{session_type}_{timestamp}"

        # åˆ›å»ºé¢è¯•ä¼šè¯
        session_id = self.db.create_session(
            user_id=user_id,
            session_name=session_name,
            session_type=session_type,
            difficulty_level=difficulty_level
        )
        
        if not session_id:
            return None
        
        # è·å–åˆ›å»ºçš„ä¼šè¯ä¿¡æ¯
        session_info = self.db.get_interview_session(session_id)
        if not session_info:
            return None
        
        return {
            "success": True,
            "session_id": session_id,
            "user_id": user_id,
            "session_name": session_name,
            "status": "created",
            "created_at": session_info["created_at"].isoformat() if session_info["created_at"] else None,
            "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
        }
        
    except Exception as e:
        logger.error(f"Difyåˆ›å»ºé¢è¯•è®°å½•å¤±è´¥: {e}")
        return {
            "success": False,
            "message": f"åˆ›å»ºå¤±è´¥: {str(e)}"
        }
```

**ä¿®æ”¹ä¸º**:
```python
def dify_create_interview(self, user_id: str, session_name: Optional[str] = None, 
                         session_type: str = "technical",
                         difficulty_level: str = "medium",
                         total_questions: int = 15,  # â† æ–°å¢å‚æ•°ï¼ˆå¿…å¡«ï¼Œæ¥è‡ªå‰ç«¯ï¼‰
                         estimated_duration: Optional[int] = None) -> Optional[Dict[str, Any]]:  # â† æ–°å¢å‚æ•°ï¼ˆå¯é€‰ï¼‰
    """Difyä¸“ç”¨ï¼šåˆ›å»ºé¢è¯•è®°å½•"""
    try:
        # å¦‚æœæ²¡æœ‰æä¾›session_nameï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤åç§°
        if not session_name:
            from datetime import datetime
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            session_name = f"é¢è¯•_{session_type}_{timestamp}"

        # å¦‚æœæ²¡æœ‰æä¾›é¢„è®¡æ—¶é•¿ï¼Œæ ¹æ®é¢˜ç›®æ•°é‡è‡ªåŠ¨è®¡ç®—
        if estimated_duration is None:
            # æ¯é¢˜é¢„è®¡3åˆ†é’Ÿï¼Œå‘ä¸Šå–æ•´åˆ°5çš„å€æ•°
            estimated_duration = ((total_questions * 3 + 4) // 5) * 5
            # æœ€å°‘20åˆ†é’Ÿï¼Œæœ€å¤š120åˆ†é’Ÿ
            estimated_duration = max(20, min(120, estimated_duration))

        # åˆ›å»ºé¢è¯•ä¼šè¯
        session_id = self.db.create_session(
            user_id=user_id,
            session_name=session_name,
            session_type=session_type,
            difficulty_level=difficulty_level,
            estimated_duration=estimated_duration,  # â† ä¼ é€’å‚æ•°
            total_questions=total_questions  # â† ä¼ é€’å‚æ•°ï¼ˆç›´æ¥ä½¿ç”¨å‰ç«¯å€¼ï¼Œä¸è®¡ç®—ï¼‰
        )
        
        if not session_id:
            return None
        
        # è·å–åˆ›å»ºçš„ä¼šè¯ä¿¡æ¯
        session_info = self.db.get_interview_session(session_id)
        if not session_info:
            return None
        
        return {
            "success": True,
            "session_id": session_id,
            "user_id": user_id,
            "session_name": session_name,
            "session_type": session_type,          # â† æ–°å¢è¿”å›
            "difficulty_level": difficulty_level,  # â† æ–°å¢è¿”å›
            "estimated_duration": estimated_duration,  # â† æ–°å¢è¿”å›
            "total_questions": total_questions,    # â† æ–°å¢è¿”å›
            "status": "created",
            "created_at": session_info["created_at"].isoformat() if session_info["created_at"] else None,
            "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
        }
        
    except Exception as e:
        logger.error(f"Difyåˆ›å»ºé¢è¯•è®°å½•å¤±è´¥: {e}")
        return {
            "success": False,
            "message": f"åˆ›å»ºå¤±è´¥: {str(e)}"
        }
```

**å…³é”®æ”¹åŠ¨è¯´æ˜**:
1. **æ–°å¢ `total_questions` å‚æ•°**ï¼šå¿…å¡«ï¼Œç›´æ¥æ¥è‡ªå‰ç«¯ç”¨æˆ·é€‰æ‹©ï¼Œä¸åšä»»ä½•è®¡ç®—
2. **æ–°å¢ `estimated_duration` å‚æ•°**ï¼šå¯é€‰ï¼Œå¦‚æœå‰ç«¯ä¸ä¼ ï¼Œåˆ™è‡ªåŠ¨è®¡ç®—ï¼ˆæ¯é¢˜3åˆ†é’Ÿï¼‰
3. **ä¼ é€’å‚æ•°ç»™æ•°æ®åº“å±‚**ï¼š`create_session()` æ–¹æ³•å·²æ”¯æŒè¿™ä¸¤ä¸ªå‚æ•°
4. **è¿”å›ç»“æœè¡¥å……4ä¸ªå­—æ®µ**ï¼šæ»¡è¶³å‰ç«¯æ¸²æŸ“éœ€æ±‚

---

#### 4. database.py - ç¡®è®¤å‚æ•°ä¼ é€’

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/database.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬229-254è¡Œ

**å½“å‰ä»£ç ï¼ˆå·²æ”¯æŒï¼‰**:
```python
def create_session(self, user_id: str, session_name: str, session_type: str = "technical", 
                  difficulty_level: str = "medium", estimated_duration: int = 60) -> Optional[str]:
    """åˆ›å»ºé¢è¯•ä¼šè¯"""
    try:
        with self.get_session() as session:
            session_id = self.generate_session_id()
            
            interview_session = InterviewSession(
                user_id=user_id,
                session_id=session_id,
                session_name=session_name,
                session_type=session_type,
                status="pending",
                difficulty_level=difficulty_level,
                estimated_duration=estimated_duration
            )
            
            session.add(interview_session)
            session.flush()
            
            logger.info(f"âœ… åˆ›å»ºé¢è¯•ä¼šè¯æˆåŠŸ: {session_id}")
            return session_id
            
    except Exception as e:
        logger.error(f"âŒ åˆ›å»ºé¢è¯•ä¼šè¯å¤±è´¥: {e}")
        return None
```

**ä¿®æ”¹ä¸º**:
```python
def create_session(self, user_id: str, session_name: str, session_type: str = "technical", 
                  difficulty_level: str = "medium", estimated_duration: int = 60,
                  total_questions: int = 15) -> Optional[str]:  # â† æ–°å¢å‚æ•°ï¼Œé»˜è®¤15é¢˜
    """åˆ›å»ºé¢è¯•ä¼šè¯"""
    try:
        with self.get_session() as session:
            session_id = self.generate_session_id()
            
            interview_session = InterviewSession(
                user_id=user_id,
                session_id=session_id,
                session_name=session_name,
                session_type=session_type,
                status="pending",
                difficulty_level=difficulty_level,
                estimated_duration=estimated_duration,
                total_questions=total_questions  # â† æ–°å¢å­—æ®µ
            )
            
            session.add(interview_session)
            session.flush()
            
            logger.info(f"âœ… åˆ›å»ºé¢è¯•ä¼šè¯æˆåŠŸ: {session_id}, é¢˜ç›®æ•°: {total_questions}, é¢„è®¡æ—¶é•¿: {estimated_duration}åˆ†é’Ÿ")
            return session_id
            
    except Exception as e:
        logger.error(f"âŒ åˆ›å»ºé¢è¯•ä¼šè¯å¤±è´¥: {e}")
        return None
```

**ä¿®æ”¹è¯´æ˜**:
- æ–°å¢ `total_questions` å‚æ•°ï¼Œé»˜è®¤å€¼15é¢˜
- åœ¨åˆ›å»º `InterviewSession` å¯¹è±¡æ—¶ä¼ å…¥è¯¥å­—æ®µ
- ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼ŒåŒ…å«é¢˜ç›®æ•°å’Œé¢„è®¡æ—¶é•¿ä¿¡æ¯

---

#### 5. main.py - APIè·¯ç”±ä¼ é€’å‚æ•°

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/main.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬155-177è¡Œ

**å½“å‰ä»£ç **:
```python
@app.post("/dify/interview/create", response_model=DifyCreateInterviewResponse)
async def dify_create_interview(request: DifyCreateInterviewRequest):
    """Difyä¸“ç”¨ï¼šåˆ›å»ºé¢è¯•è®°å½•"""
    try:
        logger.info(f"Difyåˆ›å»ºé¢è¯•è®°å½•: user_id={request.user_id}, session_name={request.session_name}")
        
        result = interview_service.dify_create_interview(
            user_id=request.user_id,
            session_name=request.session_name,
            session_type=request.session_type.value,
            difficulty_level=request.difficulty_level.value
        )
        
        if not result or not result.get("success"):
            raise HTTPException(status_code=500, detail=result.get("message", "åˆ›å»ºé¢è¯•è®°å½•å¤±è´¥"))
        
        return DifyCreateInterviewResponse(**result)
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Difyåˆ›å»ºé¢è¯•è®°å½•å¤±è´¥: {e}")
        raise HTTPException(status_code=500, detail=f"åˆ›å»ºå¤±è´¥: {str(e)}")
```

**ä¿®æ”¹ä¸º**:
```python
@app.post("/dify/interview/create", response_model=DifyCreateInterviewResponse)
async def dify_create_interview(request: DifyCreateInterviewRequest):
    """Difyä¸“ç”¨ï¼šåˆ›å»ºé¢è¯•è®°å½•"""
    try:
        logger.info(f"Difyåˆ›å»ºé¢è¯•è®°å½•: user_id={request.user_id}, total_questions={request.total_questions}")
        
        result = interview_service.dify_create_interview(
            user_id=request.user_id,
            session_name=request.session_name,
            session_type=request.session_type.value,
            difficulty_level=request.difficulty_level.value,
            total_questions=request.total_questions,  # â† æ–°å¢ä¼ é€’
            estimated_duration=request.estimated_duration  # â† æ–°å¢ä¼ é€’
        )
        
        if not result or not result.get("success"):
            raise HTTPException(status_code=500, detail=result.get("message", "åˆ›å»ºé¢è¯•è®°å½•å¤±è´¥"))
        
        return DifyCreateInterviewResponse(**result)
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Difyåˆ›å»ºé¢è¯•è®°å½•å¤±è´¥: {e}")
        raise HTTPException(status_code=500, detail=f"åˆ›å»ºå¤±è´¥: {str(e)}")
```

**ä¿®æ”¹è¯´æ˜**:
- ä¼ é€’ `total_questions` å’Œ `estimated_duration` å‚æ•°
- ä¼˜åŒ–æ—¥å¿—ï¼Œæ˜¾ç¤ºé¢˜ç›®æ•°é‡

---

#### 6. interview_service.py - ä¼˜åŒ–ä¼šè¯è¯¦æƒ…æ–¹æ³•

**æ–‡ä»¶ä½ç½®**: `interviewer/back_end/interview-service/interview_service.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬345-381è¡Œ

**å½“å‰ä»£ç **:
```python
def get_session_detail(self, session_id: str) -> Dict[str, Any]:
    """è·å–é¢è¯•ä¼šè¯è¯¦æƒ…"""
    try:
        session_info = self.db.get_interview_session(session_id)
        if not session_info:
            return {
                "success": False,
                "message": "é¢è¯•ä¼šè¯ä¸å­˜åœ¨"
            }
        
        # è·å–é¢˜ç›®åˆ—è¡¨
        questions = self.db.get_session_questions(session_id)
        
        # è·å–å›ç­”è¯¦æƒ…
        answers = []
        for question in questions:
            answer_detail = self.db.get_answer_detail(question["question_id"])
            if answer_detail:
                answers.append(answer_detail)
        
        session_info.update({
            "questions": questions,
            "answers": answers
        })
        
        return {
            "success": True,
            "session": session_info,
            "message": "è·å–é¢è¯•ä¼šè¯è¯¦æƒ…æˆåŠŸ"
        }
        
    except Exception as e:
        logger.error(f"è·å–é¢è¯•ä¼šè¯è¯¦æƒ…å¤±è´¥: {e}")
        return {
            "success": False,
            "message": f"è·å–å¤±è´¥: {str(e)}"
        }
```

**ä¿®æ”¹ä¸ºï¼ˆç®€åŒ–è¿”å›æ ¼å¼ï¼‰**:
```python
def get_session_detail(self, session_id: str) -> Dict[str, Any]:
    """è·å–é¢è¯•ä¼šè¯è¯¦æƒ…"""
    try:
        session_info = self.db.get_interview_session(session_id)
        if not session_info:
            return {
                "success": False,
                "message": "é¢è¯•ä¼šè¯ä¸å­˜åœ¨"
            }
        
        # ç®€åŒ–è¿”å›ï¼Œåªè¿”å›æ ¸å¿ƒå­—æ®µ
        return {
            "success": True,
            "session": {
                "session_id": session_info["session_id"],
                "session_name": session_info["session_name"],
                "session_type": session_info["session_type"],
                "difficulty_level": session_info["difficulty_level"],
                "estimated_duration": session_info["estimated_duration"],
                "total_questions": session_info["total_questions"],
                "status": session_info["status"],
                "created_at": session_info["created_at"].isoformat() if session_info.get("created_at") else None,
                "question_count": session_info.get("completed_questions", 0),  # å·²å®Œæˆé¢˜ç›®æ•°
                "average_score": session_info.get("average_score")
            },
            "message": "è·å–é¢è¯•ä¼šè¯è¯¦æƒ…æˆåŠŸ"
        }
        
    except Exception as e:
        logger.error(f"è·å–é¢è¯•ä¼šè¯è¯¦æƒ…å¤±è´¥: {e}")
        return {
            "success": False,
            "message": f"è·å–å¤±è´¥: {str(e)}"
        }
```

**ä¿®æ”¹è¯´æ˜**:
- ç§»é™¤ `questions` å’Œ `answers` è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚éœ€è¦å¯é€šè¿‡å…¶ä»–æ¥å£è·å–ï¼‰
- è¿”å›ç»“æ„æ›´ç®€æ´ï¼Œå­—æ®µä¸éœ€æ±‚å®Œå…¨ä¸€è‡´
- æ·»åŠ  `question_count` å­—æ®µè¡¨ç¤ºå½“å‰è¿›åº¦

---

## æ–‡æ¡£æ›´æ–°æ–¹æ¡ˆ

### æ¶‰åŠæ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | è·¯å¾„ | æ›´æ–°å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| [000]APIæ¥å£æ–‡æ¡£.md | project_document/ | æ›´æ–°åˆ›å»ºæ¥å£ã€è¡¥å……è¯¦æƒ…æ¥å£ | P0 |
| [000]é¡¹ç›®å®Œæ•´æŒ‡å—ï¼ˆå«apiï¼‰.md | project_document/ | åŒæ­¥æ›´æ–°APIè¯´æ˜ | P0 |

### æ–‡æ¡£æ›´æ–°è¯¦æƒ…

#### 1. æ›´æ–° `[000]APIæ¥å£æ–‡æ¡£.md`

##### ä½ç½®1ï¼šæ›´æ–°åˆ›å»ºé¢è¯•æ¥å£ï¼ˆç¬¬862-906è¡Œï¼‰

**æŸ¥æ‰¾å†…å®¹**:
```markdown
### 2. åˆ›å»ºé¢è¯•è®°å½•ï¼ˆDifyä¸“ç”¨ï¼‰
**URL**: `POST http://43.142.157.145:8006/dify/interview/create`
```

**æ›¿æ¢ä¸ºå®Œæ•´å†…å®¹**:

```markdown
### 2. åˆ›å»ºé¢è¯•è®°å½•ï¼ˆDifyä¸“ç”¨ï¼‰
**URL**: `POST http://43.142.157.145:8006/dify/interview/create`

**åŠŸèƒ½ä»‹ç»**: ä¸ºDifyå·¥ä½œæµåˆ›å»ºæ–°çš„é¢è¯•ä¼šè¯è®°å½•

**å‚æ•°è§„èŒƒ**:
```json
{
  "user_id": "user_001",
  "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "total_questions": 15,
  "estimated_duration": 45
}
```

**å‚æ•°è¯´æ˜**:
- `user_id` (å­—ç¬¦ä¸², å¿…å¡«): ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
- `session_name` (å­—ç¬¦ä¸², å¯é€‰): é¢è¯•ä¼šè¯åç§°
- `session_type` (å­—ç¬¦ä¸², å¿…å¡«): é¢è¯•ç±»å‹ï¼Œå¯é€‰å€¼ï¼šknowledge_based/company_position/resume_customized/wrong_questions
- `difficulty_level` (å­—ç¬¦ä¸², å¿…å¡«): éš¾åº¦çº§åˆ«ï¼Œå¯é€‰å€¼ï¼šeasy/medium/hard
- `total_questions` (æ•´æ•°, å¿…å¡«): é¢˜ç›®æ€»æ•°ï¼Œç”±å‰ç«¯ç”¨æˆ·æŒ‡å®šï¼ŒèŒƒå›´5-30
- `estimated_duration` (æ•´æ•°, å¯é€‰): é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤45åˆ†é’Ÿï¼ŒèŒƒå›´10-180

**è¿”å›æ ¼å¼**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "user_id": "user_001",
  "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "estimated_duration": 45,
  "total_questions": 15,
  "status": "created",
  "created_at": "2025-09-05T21:10:46",
  "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/create" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "total_questions": 15,
    "estimated_duration": 45
  }'
```
```

##### ä½ç½®2ï¼šè¡¥å……ä¼šè¯è¯¦æƒ…æ¥å£æ–‡æ¡£ï¼ˆæ’å…¥åˆ°ç¬¬829è¡Œåï¼‰

**æ’å…¥ä½ç½®**: åœ¨ "### 8. å¼€å§‹é¢è¯•ï¼ˆæ ‡å‡†APIï¼‰" ä¹‹å‰

**æ’å…¥å†…å®¹**:

```markdown
### X. è·å–ä¼šè¯è¯¦æƒ…
**URL**: `GET http://43.142.157.145:8006/interview/sessions/{session_id}/detail`

**åŠŸèƒ½ä»‹ç»**: è·å–é¢è¯•ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¼šè¯å…ƒæ•°æ®å’Œç»Ÿè®¡æ•°æ®

**å‚æ•°è§„èŒƒ**:
- `session_id` (è·¯å¾„å‚æ•°, å¿…å¡«): é¢è¯•ä¼šè¯ID

**è¿”å›æ ¼å¼**:
```json
{
  "success": true,
  "session": {
    "session_id": "session_xxx",
    "session_name": "Pythonå¼€å‘å·¥ç¨‹å¸ˆé¢è¯•",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "estimated_duration": 45,
    "total_questions": 15,
    "status": "created",
    "created_at": "2025-10-30T10:00:00",
    "question_count": 0,
    "average_score": null
  },
  "message": "è·å–é¢è¯•ä¼šè¯è¯¦æƒ…æˆåŠŸ"
}
```

**å­—æ®µè¯´æ˜**:
- `session_id`: é¢è¯•ä¼šè¯å”¯ä¸€æ ‡è¯†
- `session_name`: é¢è¯•åç§°
- `session_type`: é¢è¯•ç±»å‹ï¼ˆknowledge_based/company_position/resume_customized/wrong_questionsï¼‰
- `difficulty_level`: éš¾åº¦çº§åˆ«ï¼ˆeasy/medium/hardï¼‰
- `estimated_duration`: é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
- `total_questions`: é¢˜ç›®æ€»æ•°
- `status`: ä¼šè¯çŠ¶æ€ï¼ˆcreated/in_progress/completed/cancelledï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰
- `question_count`: å·²å®Œæˆé¢˜ç›®æ•°
- `average_score`: å¹³å‡åˆ†æ•°

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
curl "http://43.142.157.145:8006/interview/sessions/session_xxx/detail"
```
```

#### 2. æ›´æ–° `[000]é¡¹ç›®å®Œæ•´æŒ‡å—ï¼ˆå«apiï¼‰.md`

åŒæ ·çš„ä¿®æ”¹å†…å®¹ï¼Œæ›´æ–°å¯¹åº”ç« èŠ‚ï¼ˆç¬¬1224-1268è¡Œå’Œç¬¬1190è¡Œé™„è¿‘ï¼‰ã€‚

---

## æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

### æµ‹è¯•ç¯å¢ƒ
- **æœåŠ¡å™¨**: 43.142.157.145
- **ç«¯å£**: 8006
- **æ•°æ®åº“**: MySQL 8.0 (interview_analysis)

### æµ‹è¯•ç”¨ä¾‹æ¸…å•

#### æµ‹è¯•ç”¨ä¾‹1ï¼šåˆ›å»ºä¼šè¯ï¼ˆä¼ å…¥å®Œæ•´å‚æ•°ï¼‰

**è¯·æ±‚**:
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/create" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user_001",
    "session_name": "æµ‹è¯•é¢è¯•",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "total_questions": 20,
    "estimated_duration": 60
  }'
```

**é¢„æœŸè¿”å›**:
```json
{
  "success": true,
  "session_id": "session_xxx",
  "user_id": "test_user_001",
  "session_name": "æµ‹è¯•é¢è¯•",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "estimated_duration": 60,
  "total_questions": 20,
  "status": "created",
  "created_at": "2025-10-31T...",
  "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
}
```

**éªŒè¯ç‚¹**:
- âœ… è¿”å›åŒ…å« `session_type`, `difficulty_level`, `estimated_duration`, `total_questions` å››ä¸ªå­—æ®µ
- âœ… `total_questions` å€¼ä¸º 20ï¼ˆä¸è¯·æ±‚ä¸€è‡´ï¼‰
- âœ… `estimated_duration` å€¼ä¸º 60ï¼ˆä¸è¯·æ±‚ä¸€è‡´ï¼‰

---

#### æµ‹è¯•ç”¨ä¾‹2ï¼šåˆ›å»ºä¼šè¯ï¼ˆä¸ä¼  estimated_durationï¼‰

**è¯·æ±‚**:
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/create" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user_001",
    "session_name": "æµ‹è¯•é¢è¯•2",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "total_questions": 15
  }'
```

**é¢„æœŸè¿”å›**:
```json
{
  "success": true,
  "session_id": "session_yyy",
  "user_id": "test_user_001",
  "session_name": "æµ‹è¯•é¢è¯•2",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "estimated_duration": 45,
  "total_questions": 15,
  "status": "created",
  "created_at": "2025-10-31T...",
  "message": "é¢è¯•è®°å½•åˆ›å»ºæˆåŠŸ"
}
```

**éªŒè¯ç‚¹**:
- âœ… `estimated_duration` è‡ªåŠ¨è®¡ç®—ä¸º 45 åˆ†é’Ÿï¼ˆ15é¢˜ Ã— 3åˆ†é’Ÿ/é¢˜ = 45åˆ†é’Ÿï¼‰
- âœ… `total_questions` å€¼ä¸º 15ï¼ˆä¸è¯·æ±‚ä¸€è‡´ï¼‰

---

#### æµ‹è¯•ç”¨ä¾‹3ï¼šæŸ¥è¯¢ä¼šè¯è¯¦æƒ…

**è¯·æ±‚**:
```bash
curl "http://43.142.157.145:8006/interview/sessions/{session_id}/detail"
```

**é¢„æœŸè¿”å›**:
```json
{
  "success": true,
  "session": {
    "session_id": "session_xxx",
    "session_name": "æµ‹è¯•é¢è¯•",
    "session_type": "resume_customized",
    "difficulty_level": "medium",
    "estimated_duration": 60,
    "total_questions": 20,
    "status": "created",
    "created_at": "2025-10-31T...",
    "question_count": 0,
    "average_score": null
  },
  "message": "è·å–é¢è¯•ä¼šè¯è¯¦æƒ…æˆåŠŸ"
}
```

**éªŒè¯ç‚¹**:
- âœ… è¿”å›ç»“æ„ç®€æ´ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
- âœ… `total_questions` å’Œ `estimated_duration` æ­£ç¡®æ˜¾ç¤º
- âœ… `question_count` æ˜¾ç¤ºå·²å®Œæˆé¢˜ç›®æ•°

---

#### æµ‹è¯•ç”¨ä¾‹4ï¼šæ•°æ®åº“éªŒè¯

**æŸ¥è¯¢SQL**:
```sql
-- æŸ¥è¯¢æœ€æ–°åˆ›å»ºçš„ä¼šè¯
SELECT session_id, session_name, session_type, difficulty_level, 
       estimated_duration, total_questions, status, created_at
FROM interview_sessions
WHERE user_id = 'test_user_001'
ORDER BY created_at DESC
LIMIT 1;
```

**é¢„æœŸç»“æœ**:
- âœ… `estimated_duration` å­—æ®µæ­£ç¡®ä¿å­˜
- âœ… `total_questions` å­—æ®µæ­£ç¡®ä¿å­˜
- âœ… å€¼ä¸APIè¿”å›ä¸€è‡´

---

#### æµ‹è¯•ç”¨ä¾‹5ï¼šè¾¹ç•Œå€¼æµ‹è¯•

**è¯·æ±‚1ï¼ˆæœ€å°é¢˜ç›®æ•°ï¼‰**:
```json
{
  "user_id": "test_user_001",
  "session_type": "resume_customized",
  "difficulty_level": "easy",
  "total_questions": 5
}
```

**é¢„æœŸ**: âœ… æˆåŠŸåˆ›å»ºï¼Œ`total_questions` = 5

**è¯·æ±‚2ï¼ˆæœ€å¤§é¢˜ç›®æ•°ï¼‰**:
```json
{
  "user_id": "test_user_001",
  "session_type": "resume_customized",
  "difficulty_level": "hard",
  "total_questions": 30
}
```

**é¢„æœŸ**: âœ… æˆåŠŸåˆ›å»ºï¼Œ`total_questions` = 30

**è¯·æ±‚3ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰**:
```json
{
  "user_id": "test_user_001",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "total_questions": 50
}
```

**é¢„æœŸ**: âŒ è¿”å›400é”™è¯¯ï¼Œæç¤ºå‚æ•°è¶…å‡ºèŒƒå›´

---

### æµ‹è¯•æ‰§è¡Œæ¸…å•

| æµ‹è¯•é¡¹ | æµ‹è¯•æ–¹æ³• | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| åˆ›å»ºä¼šè¯ï¼ˆå®Œæ•´å‚æ•°ï¼‰ | curlè¯·æ±‚ | è¿”å›åŒ…å«4ä¸ªæ–°å¢å­—æ®µ | P0 |
| åˆ›å»ºä¼šè¯ï¼ˆè‡ªåŠ¨è®¡ç®—æ—¶é•¿ï¼‰ | curlè¯·æ±‚ | estimated_durationè‡ªåŠ¨è®¡ç®— | P0 |
| æŸ¥è¯¢ä¼šè¯è¯¦æƒ… | curlè¯·æ±‚ | è¿”å›ç®€æ´ç»“æ„ | P0 |
| æ•°æ®åº“å­˜å‚¨éªŒè¯ | SQLæŸ¥è¯¢ | å­—æ®µæ­£ç¡®ä¿å­˜ | P0 |
| è¾¹ç•Œå€¼æµ‹è¯• | curlè¯·æ±‚ | èŒƒå›´éªŒè¯ç”Ÿæ•ˆ | P1 |
| é”™è¯¯å¤„ç† | curlè¯·æ±‚ï¼ˆé”™è¯¯å‚æ•°ï¼‰ | è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯ | P1 |

---

## Difyå·¥ä½œæµé…ç½®è¯´æ˜

### å·¥ä½œæµè°ƒç”¨æµç¨‹

```
1. å‰ç«¯é¡µé¢ 
   â†“ ç”¨æˆ·é€‰æ‹©é¢˜ç›®æ•°é‡ã€éš¾åº¦
   
2. å‰ç«¯è°ƒç”¨åç«¯ API
   â†“ POST /dify/interview/create
   â†“ body: { total_questions: 15, ... }
   
3. åç«¯ä¿å­˜å¹¶è¿”å›
   â†“ response: { session_id, total_questions: 15, ... }
   
4. å‰ç«¯è°ƒç”¨ Dify å·¥ä½œæµ
   â†“ ä¼ å…¥: session_id, total_questions
   
5. Dify å·¥ä½œæµæ‰§è¡Œ
   â†“ å¾ªç¯ total_questions æ¬¡ç”Ÿæˆé¢˜ç›®
```

### Difyå·¥ä½œæµæ— éœ€ä¿®æ”¹ï¼ˆæ¨èï¼‰

å¦‚æœ Dify å·¥ä½œæµå½“å‰æ²¡æœ‰ä½¿ç”¨ `estimated_duration` å’Œ `total_questions` å‚æ•°ï¼Œåˆ™**æ— éœ€ä¿®æ”¹ Dify é…ç½®**ã€‚

åç«¯å·²å®Œæˆä¿®æ”¹ï¼Œå‰ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨è¿”å›çš„å­—æ®µè¿›è¡Œæ¸²æŸ“ã€‚

### Difyå·¥ä½œæµå¯é€‰ä¿®æ”¹ï¼ˆå¦‚éœ€ä½¿ç”¨ï¼‰

å¦‚æœ Dify å·¥ä½œæµéœ€è¦ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹é…ç½®ï¼š

#### å¼€å§‹èŠ‚ç‚¹ - è¾“å…¥å˜é‡

```yaml
è¾“å…¥å˜é‡:
  - user_id: æ–‡æœ¬ï¼ˆå¿…å¡«ï¼‰
  - session_id: æ–‡æœ¬ï¼ˆå¿…å¡«ï¼‰
  - total_questions: æ•°å­—ï¼ˆå¿…å¡«ï¼‰  # â† å‰ç«¯ä¼ å…¥
  - difficulty_level: æ–‡æœ¬ï¼ˆå¿…å¡«ï¼‰
```

#### HTTPè¯·æ±‚èŠ‚ç‚¹ - åˆ›å»ºä¼šè¯

```json
{
  "url": "http://localhost:8006/dify/interview/create",
  "method": "POST",
  "body": {
    "user_id": "{{user_id}}",
    "session_type": "resume_customized",
    "difficulty_level": "{{difficulty_level}}",
    "total_questions": {{total_questions}}  // â† ä½¿ç”¨å‰ç«¯ä¼ å…¥çš„å€¼
  }
}
```

#### å¾ªç¯èŠ‚ç‚¹ - ç”Ÿæˆé¢˜ç›®

```yaml
å¾ªç¯ç±»å‹: è®¡æ•°å¾ªç¯
å¾ªç¯æ¬¡æ•°: {{total_questions}}  # â† ä½¿ç”¨å‰ç«¯ä¼ å…¥çš„é¢˜ç›®æ•°é‡
å¾ªç¯ä½“:
  - [LLM] ç”Ÿæˆé¢˜ç›®
  - [HTTP] è®°å½•é¢˜ç›®å’Œç­”æ¡ˆ
```

---

## é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | åº”å¯¹æªæ–½ |
|--------|----------|----------|----------|
| å­—æ®µé»˜è®¤å€¼ä¸ä¸€è‡´ | ğŸŸ¡ ä½ | æ•°æ®åº“ | ä»£ç å±‚é¢å¤„ç†ï¼Œä¸ä¾èµ–æ•°æ®åº“é»˜è®¤å€¼ |
| APIå“åº”æ ¼å¼å˜åŒ– | ğŸŸ¢ æä½ | å‰ç«¯ | åªå¢åŠ å­—æ®µï¼Œä¸åˆ é™¤å­—æ®µï¼Œå‘åå…¼å®¹ |
| Difyå·¥ä½œæµå…¼å®¹æ€§ | ğŸŸ¢ æä½ | Dify | æ–°å¢å‚æ•°å¯é€‰ï¼Œä¸å½±å“ç°æœ‰å·¥ä½œæµ |
| ä»£ç ä¿®æ”¹é”™è¯¯ | ğŸŸ¡ ä½ | åç«¯æœåŠ¡ | å……åˆ†æµ‹è¯•åå†éƒ¨ç½² |

### å…¼å®¹æ€§åˆ†æ

#### å‘åå…¼å®¹æ€§ âœ…

- **APIè¯·æ±‚**: æ–°å¢å­—æ®µä¸ºå¯é€‰ï¼ˆ`estimated_duration`ï¼‰æˆ–æœ‰é»˜è®¤å€¼ï¼ˆ`total_questions`ï¼‰
- **APIå“åº”**: åªå¢åŠ å­—æ®µï¼Œä¸åˆ é™¤å­—æ®µï¼Œä¸å½±å“ç°æœ‰è°ƒç”¨æ–¹
- **æ•°æ®åº“**: å­—æ®µå·²å­˜åœ¨ï¼Œæ— éœ€è¿ç§»æ•°æ®

#### å‰å‘å…¼å®¹æ€§ âœ…

- æ–°å­—æ®µå·²é¢„ç•™æ‰©å±•æ€§
- æœªæ¥å¯èƒ½çš„æ‰©å±•ï¼š
  - æ ¹æ®é¢è¯•ç±»å‹è‡ªåŠ¨æ¨èé¢˜ç›®æ•°é‡
  - æ ¹æ®å†å²è®°å½•æ™ºèƒ½è°ƒæ•´é¢„è®¡æ—¶é•¿

---

## å®æ–½æ­¥éª¤æ¸…å•

### é˜¶æ®µ1ï¼šä»£ç ä¿®æ”¹ï¼ˆé¢„è®¡30åˆ†é’Ÿï¼‰

| æ­¥éª¤ | æ“ä½œ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|------|------|------|----------|
| 1.1 | ä¿®æ”¹è¯·æ±‚æ¨¡å‹ | models.py | 5åˆ†é’Ÿ |
| 1.2 | ä¿®æ”¹å“åº”æ¨¡å‹ | models.py | 5åˆ†é’Ÿ |
| 1.3 | ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ | interview_service.py | 10åˆ†é’Ÿ |
| 1.4 | ä¿®æ”¹æ•°æ®åº“æ“ä½œ | database.py | 5åˆ†é’Ÿ |
| 1.5 | ä¿®æ”¹APIè·¯ç”± | main.py | 5åˆ†é’Ÿ |
| 1.6 | ä¼˜åŒ–ä¼šè¯è¯¦æƒ…æ–¹æ³• | interview_service.py | 10åˆ†é’Ÿ |

### é˜¶æ®µ2ï¼šæ–‡æ¡£æ›´æ–°ï¼ˆé¢„è®¡20åˆ†é’Ÿï¼‰

| æ­¥éª¤ | æ“ä½œ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|------|------|------|----------|
| 2.1 | æ›´æ–°åˆ›å»ºæ¥å£æ–‡æ¡£ | [000]APIæ¥å£æ–‡æ¡£.md | 10åˆ†é’Ÿ |
| 2.2 | è¡¥å……è¯¦æƒ…æ¥å£æ–‡æ¡£ | [000]APIæ¥å£æ–‡æ¡£.md | 5åˆ†é’Ÿ |
| 2.3 | åŒæ­¥é¡¹ç›®æŒ‡å— | [000]é¡¹ç›®å®Œæ•´æŒ‡å—ï¼ˆå«apiï¼‰.md | 5åˆ†é’Ÿ |

### é˜¶æ®µ3ï¼šæµ‹è¯•éªŒè¯ï¼ˆé¢„è®¡20åˆ†é’Ÿï¼‰

| æ­¥éª¤ | æ“ä½œ | å·¥å…· | é¢„è®¡æ—¶é—´ |
|------|------|------|----------|
| 3.1 | é‡å¯æœåŠ¡ | systemctl/nohup | 2åˆ†é’Ÿ |
| 3.2 | æµ‹è¯•åˆ›å»ºæ¥å£ | curl | 5åˆ†é’Ÿ |
| 3.3 | æµ‹è¯•è¯¦æƒ…æ¥å£ | curl | 3åˆ†é’Ÿ |
| 3.4 | éªŒè¯æ•°æ®åº“ | MySQL | 5åˆ†é’Ÿ |
| 3.5 | è¾¹ç•Œå€¼æµ‹è¯• | curl | 5åˆ†é’Ÿ |

### é˜¶æ®µ4ï¼šéƒ¨ç½²ä¸Šçº¿ï¼ˆé¢„è®¡10åˆ†é’Ÿï¼‰

| æ­¥éª¤ | æ“ä½œ | å‘½ä»¤ | é¢„è®¡æ—¶é—´ |
|------|------|------|----------|
| 4.1 | åœæ­¢æœåŠ¡ | `pkill -f interview-service` | 1åˆ†é’Ÿ |
| 4.2 | å¯åŠ¨æœåŠ¡ | `nohup python3 main.py &` | 2åˆ†é’Ÿ |
| 4.3 | å¥åº·æ£€æŸ¥ | `curl /health` | 1åˆ†é’Ÿ |
| 4.4 | å‰ç«¯éªŒè¯ | å‰ç«¯æµ‹è¯• | 5åˆ†é’Ÿ |
| 4.5 | ç›‘æ§æ—¥å¿— | `tail -f logs/` | 1åˆ†é’Ÿ |

### æ€»é¢„è®¡æ—¶é—´ï¼š80åˆ†é’Ÿï¼ˆçº¦1.5å°æ—¶ï¼‰

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

| éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† | éªŒæ”¶æ–¹æ³• |
|--------|----------|----------|
| åˆ›å»ºæ¥å£è¿”å›å®Œæ•´ | è¿”å›åŒ…å« `session_type`, `difficulty_level`, `estimated_duration`, `total_questions` | APIæµ‹è¯• |
| å‚æ•°æ­£ç¡®ä¼ é€’ | `total_questions` æ¥è‡ªå‰ç«¯ï¼Œä¸åšè®¡ç®— | æ•°æ®åº“éªŒè¯ |
| è‡ªåŠ¨è®¡ç®—æ—¶é•¿ | ä¸ä¼  `estimated_duration` æ—¶è‡ªåŠ¨è®¡ç®— | APIæµ‹è¯• |
| è¯¦æƒ…æ¥å£æ­£å¸¸ | è¿”å›ç®€æ´ç»“æ„ï¼ŒåŒ…å«å¿…è¦å­—æ®µ | APIæµ‹è¯• |
| æ–‡æ¡£åŒæ­¥æ›´æ–° | APIæ–‡æ¡£ä¸ä»£ç å®ç°ä¸€è‡´ | æ–‡æ¡£å®¡æŸ¥ |

### æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | éªŒæ”¶æ–¹æ³• |
|------|--------|----------|
| åˆ›å»ºæ¥å£å“åº”æ—¶é—´ | < 500ms | APIæµ‹è¯• |
| è¯¦æƒ…æ¥å£å“åº”æ—¶é—´ | < 200ms | APIæµ‹è¯• |
| æ•°æ®åº“å†™å…¥æˆåŠŸç‡ | 100% | å‹åŠ›æµ‹è¯• |

### å…¼å®¹æ€§éªŒæ”¶

| éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† | éªŒæ”¶æ–¹æ³• |
|--------|----------|----------|
| å‘åå…¼å®¹ | æ—§ç‰ˆæœ¬å‰ç«¯è°ƒç”¨ä¸æŠ¥é”™ | é›†æˆæµ‹è¯• |
| æ•°æ®å®Œæ•´æ€§ | æ•°æ®åº“å­—æ®µæ­£ç¡®ä¿å­˜ | æ•°æ®éªŒè¯ |
| Difyå·¥ä½œæµå…¼å®¹ | ä¸å½±å“ç°æœ‰å·¥ä½œæµ | å·¥ä½œæµæµ‹è¯• |

---

## é™„å½•

### é™„å½•Aï¼šç›¸å…³æ–‡æ¡£é“¾æ¥

- `[000]APIæ¥å£æ–‡æ¡£.md`
- `[000]é¡¹ç›®å®Œæ•´æŒ‡å—ï¼ˆå«apiï¼‰.md`
- `[001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`

### é™„å½•Bï¼šå…³é”®é…ç½®æ–‡ä»¶

- `interviewer/back_end/interview-service/models.py`
- `interviewer/back_end/interview-service/interview_service.py`
- `interviewer/back_end/interview-service/database.py`
- `interviewer/back_end/interview-service/main.py`

### é™„å½•Cï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯

- **ä¸»æœº**: localhost
- **ç«¯å£**: 3306
- **æ•°æ®åº“**: interview_analysis
- **è¡¨**: interview_sessions

### é™„å½•Dï¼šæœåŠ¡ä¿¡æ¯

- **æœåŠ¡å**: interview-service
- **ç«¯å£**: 8006
- **æœåŠ¡å™¨**: 43.142.157.145
- **æ—¥å¿—è·¯å¾„**: `/tmp/interview.log`

---

## æ–‡æ¡£æ›´æ–°è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | æ›´æ–°å†…å®¹ | æ›´æ–°äºº |
|------|------|----------|--------|
| 2025-10-31 | v1.0 | åˆå§‹ç‰ˆæœ¬åˆ›å»º | AI Assistant |

---

**å®¡æ‰¹æµç¨‹**:
- [ ] æŠ€æœ¯å®¡æ ¸
- [ ] æµ‹è¯•éªŒè¯
- [ ] æ­£å¼å®æ–½
- [ ] éƒ¨ç½²ä¸Šçº¿

**å®æ–½è´Ÿè´£äºº**: å¾…æŒ‡å®š  
**é¢„è®¡å®Œæˆæ—¶é—´**: å®¡æ‰¹é€šè¿‡å 2 å°æ—¶å†…
