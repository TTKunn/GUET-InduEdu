# [001]数据库设计文档

**文档编号**: 001  
**文档类型**: 核心文档 - 数据库设计文档  
**创建时间**: 2025-09-05  
**最后更新**: 2025-10-30  
**项目名称**: GUET-InduEdu AI智能面试官系统

---

## 目录

1. [数据库架构概述](#数据库架构概述)
2. [简历分析数据库 (interview_analysis)](#简历分析数据库-interview_analysis)
   - [users 表 - 用户认证主表](#users-表---用户认证主表)
   - [candidate_profiles 表 - 候选人档案主表](#candidate_profiles-表---候选人档案主表)
   - [work_experiences 表 - 工作经验表](#work_experiences-表---工作经验表)
   - [projects 表 - 项目经验表](#projects-表---项目经验表)
   - [technical_skills 表 - 技术技能表](#technical_skills-表---技术技能表)
3. [面试记录数据库 (interview_service)](#面试记录数据库-interview_service)
   - [interview_sessions 表 - 面试会话主表](#interview_sessions-表---面试会话主表)
   - [interview_questions 表 - 面试题目表](#interview_questions-表---面试题目表)
   - [interview_answers 表 - 面试回答表](#interview_answers-表---面试回答表)
4. [数据库设计总览](#数据库设计总览)
5. [数据库设计特点](#数据库设计特点)
6. [开发历程](#开发历程)

---

## 数据库架构概述

项目采用MySQL 8.0作为主要数据存储，设计了两个核心数据库：
- **interview_analysis**: 简历分析相关数据（包含用户认证表）
- **interview_service**: 面试记录相关数据
- **用户认证系统**: 复用interview_analysis数据库，通过user_id字段关联

---

## 简历分析数据库 (interview_analysis)

### users 表 - 用户认证主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(36) | 是 | - | 用户UUID，唯一标识 |
| username | VARCHAR(50) | 是 | - | 用户名，唯一 |
| email | VARCHAR(100) | 是 | - | 邮箱地址，唯一 |
| password_hash | VARCHAR(255) | 是 | - | 密码哈希值（bcrypt） |
| is_active | BOOLEAN | 是 | TRUE | 是否激活 |
| is_verified | BOOLEAN | 是 | FALSE | 是否验证邮箱 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| last_login_at | TIMESTAMP | 否 | NULL | 最后登录时间 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | user_id | 唯一索引 | 确保用户UUID唯一 |
| UNIQUE | username | 唯一索引 | 确保用户名唯一 |
| UNIQUE | email | 唯一索引 | 确保邮箱唯一 |
| idx_is_active | is_active | 普通索引 | 支持按激活状态筛选 |
| idx_created_at | created_at | 普通索引 | 支持按创建时间排序 |

**关联关系**:
- 通过 `user_id` 字段与 `candidate_profiles` 表关联
- 一个用户对应一个候选人档案（1:1关系）
- 支持用户注册后逐步完善简历信息

**数据迁移说明**:
- **迁移时间**: 2025-09-10 21:25:27
- **迁移数量**: 15个现有用户成功迁移
- **默认密码**: 123456 (bcrypt加密存储)
- **迁移策略**: 从candidate_profiles表同步用户基本信息到users表
- **密码安全**: 使用bcrypt算法，每次加密产生不同哈希值，防彩虹表攻击
- **关联验证**: 所有迁移用户均可正常登录，两表关联关系正确

---

### candidate_profiles 表 - 候选人档案主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户唯一标识，UNIQUE约束 |
| name | VARCHAR(100) | 否 | NULL | 姓名 |
| phone | VARCHAR(20) | 否 | NULL | 电话号码 |
| email | VARCHAR(100) | 否 | NULL | 邮箱地址 |
| location | VARCHAR(200) | 否 | NULL | 居住地址 |
| education | TEXT | 否 | NULL | 教育背景描述 |
| direction | VARCHAR(100) | 否 | NULL | 技术发展方向 |
| total_experience_years | INTEGER | 否 | NULL | 总工作年限 |
| skill_level | VARCHAR(50) | 否 | NULL | 技能水平等级 |
| technical_skills_json | TEXT | 否 | NULL | 技术技能JSON存储 |
| projects_keywords_json | TEXT | 否 | NULL | 项目关键词JSON存储 |
| education_json | TEXT | 否 | NULL | 教育背景JSON存储 |
| **age** | **INTEGER** | **否** | **NULL** | **年龄（新增扩展字段）** |
| **gender** | **VARCHAR(10)** | **否** | **NULL** | **性别（新增扩展字段）** |
| **ethnicity** | **VARCHAR(50)** | **否** | **NULL** | **民族（新增扩展字段）** |
| **political_status** | **VARCHAR(50)** | **否** | **NULL** | **政治面貌（新增扩展字段）** |
| **university** | **VARCHAR(200)** | **否** | **NULL** | **院校（新增扩展字段）** |
| **major** | **VARCHAR(100)** | **否** | **NULL** | **专业（新增扩展字段）** |
| **work_experience_detail_json** | **TEXT** | **否** | **NULL** | **工作经验详细内容JSON（新增扩展字段）** |
| **project_experience_detail_json** | **TEXT** | **否** | **NULL** | **项目经验详细内容JSON（新增扩展字段）** |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | user_id | 唯一索引 | 确保用户ID唯一 |
| idx_name | name | 普通索引 | 支持按姓名查询 |
| idx_skill_level | skill_level | 普通索引 | 支持按技能等级筛选 |

---

### work_experiences 表 - 工作经验表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| company | VARCHAR(200) | 否 | NULL | 公司名称 |
| position | VARCHAR(100) | 否 | NULL | 职位名称 |
| start_date | VARCHAR(50) | 否 | NULL | 开始时间 |
| end_date | VARCHAR(50) | 否 | NULL | 结束时间 |
| description | TEXT | 否 | NULL | 工作内容描述 |
| technologies | TEXT | 否 | NULL | 使用的技术栈 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询工作经验 |

---

### projects 表 - 项目经验表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| name | VARCHAR(200) | 是 | - | 项目名称 |
| description | TEXT | 否 | NULL | 项目详细描述 |
| technologies | TEXT | 否 | NULL | 项目使用的技术栈 |
| role | VARCHAR(100) | 否 | NULL | 在项目中担任的角色 |
| achievements | TEXT | 否 | NULL | 项目成果和收获 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询项目经验 |
| 索引 | idx_name | name | 支持按项目名称查询 |

---

### technical_skills 表 - 技术技能表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| skill_name | VARCHAR(100) | 是 | - | 技能名称（如Python、Java等） |
| skill_category | VARCHAR(50) | 否 | NULL | 技能分类（编程语言、框架、数据库等） |
| proficiency_level | VARCHAR(20) | 否 | NULL | 熟练程度（初级、中级、高级、专家） |
| years_of_experience | INTEGER | 否 | NULL | 使用该技能的年限 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询技能 |
| 索引 | idx_skill_name | skill_name | 支持按技能名称查询 |
| 索引 | idx_skill_category | skill_category | 支持按技能分类筛选 |

---

## 面试记录数据库 (interview_service)

### interview_sessions 表 - 面试会话主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID |
| session_id | VARCHAR(100) | 是 | - | 会话唯一标识，UNIQUE约束 |
| session_name | VARCHAR(200) | 否 | NULL | 面试名称 |
| session_type | VARCHAR(50) | 否 | 'knowledge_based' | 面试类型 |
| status | VARCHAR(20) | 否 | 'pending' | 会话状态 |
| difficulty_level | VARCHAR(20) | 否 | 'medium' | 面试难度 |
| estimated_duration | INTEGER | 否 | 60 | 预计时长(分钟) |
| actual_duration | INTEGER | 否 | NULL | 实际时长(分钟) |
| start_time | TIMESTAMP | 否 | NULL | 开始时间 |
| end_time | TIMESTAMP | 否 | NULL | 结束时间 |
| total_questions | INTEGER | 否 | 0 | 总题目数 |
| completed_questions | INTEGER | 否 | 0 | 已完成题目数 |
| average_score | DECIMAL(3,1) | 否 | NULL | 平均分数 |
| interviewer_notes | TEXT | 否 | NULL | 面试官备注 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| session_type | knowledge_based | 自选知识点面试 |
|  | company_position | 自选公司岗位面试 |
|  | resume_customized | 个人简历定制面试 |
|  | wrong_questions | 错题面试 |
| status | pending | 待开始 |
|  | in_progress | 进行中 |
|  | completed | 已完成 |
|  | cancelled | 已取消 |
| difficulty_level | easy | 简单 |
|  | medium | 中等 |
|  | hard | 困难 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | session_id | 唯一索引 | 确保会话ID唯一 |
| idx_user_id | user_id | 普通索引 | 支持按用户查询会话 |
| idx_status | status | 普通索引 | 支持按状态筛选 |
| idx_session_type | session_type | 普通索引 | 支持按面试类型筛选 |
| idx_created_at | created_at | 普通索引 | 支持按创建时间排序 |

---

### interview_questions 表 - 面试题目表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| session_id | VARCHAR(100) | 是 | - | 会话ID，外键关联interview_sessions |
| question_id | VARCHAR(150) | 是 | - | 题目唯一标识，UNIQUE约束 |
| question_text | TEXT | 是 | - | 题目内容 |
| question_type | VARCHAR(50) | 是 | - | 题目类型 |
| question_category | VARCHAR(100) | 否 | NULL | 题目分类 |
| difficulty_level | VARCHAR(20) | 否 | NULL | 题目难度 |
| expected_duration | INTEGER | 否 | NULL | 预期回答时长(分钟) |
| reference_answer | TEXT | 否 | NULL | 参考答案 |
| scoring_criteria | TEXT | 否 | NULL | 评分标准 |
| sort_order | INTEGER | 否 | 0 | 排序 |
| is_required | BOOLEAN | 否 | TRUE | 是否必答 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| question_type | technical | 技术题 |
|  | behavioral | 行为题 |
|  | logical | 逻辑题 |
|  | project_based | 项目题 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 唯一 | UNIQUE | question_id | 确保题目ID唯一 |
| 外键 | FK_session_id | session_id | 关联interview_sessions.session_id，级联删除 |
| 索引 | idx_session_id | session_id | 支持按会话查询题目 |
| 索引 | idx_question_type | question_type | 支持按题目类型筛选 |
| 索引 | idx_sort_order | sort_order | 支持按排序查询 |

---

### interview_answers 表 - 面试回答表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| session_id | VARCHAR(100) | 是 | - | 会话ID，外键关联interview_sessions |
| question_id | VARCHAR(150) | 是 | - | 题目ID，外键关联interview_questions |
| answer_id | VARCHAR(200) | 是 | - | 回答唯一标识，UNIQUE约束 |
| candidate_answer | TEXT | 是 | - | 候选人回答内容 |
| answer_duration | INTEGER | 否 | NULL | 回答时长(秒) |
| status | VARCHAR(20) | 否 | 'answered' | 回答状态 |
| interviewer_feedback | TEXT | 是 | - | 面试官反馈 |
| technical_accuracy | DECIMAL(3,1) | 否 | NULL | 技术准确性评分(0-10) |
| communication_clarity | DECIMAL(3,1) | 否 | NULL | 表达清晰度评分(0-10) |
| problem_solving | DECIMAL(3,1) | 否 | NULL | 问题解决能力评分(0-10) |
| overall_score | DECIMAL(3,1) | 是 | - | 综合评分(0-10) |
| answer_quality | VARCHAR(20) | 否 | NULL | 回答质量等级 |
| submitted_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 提交时间 |
| reviewed_at | TIMESTAMP | 否 | NULL | 评审时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| status | answered | 已回答 |
|  | reviewing | 评审中 |
|  | reviewed | 已评审 |
| answer_quality | excellent | 优秀 |
|  | good | 良好 |
|  | average | 一般 |
|  | poor | 较差 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 唯一 | UNIQUE | answer_id | 确保回答ID唯一 |
| 外键 | FK_session_id | session_id | 关联interview_sessions.session_id，级联删除 |
| 外键 | FK_question_id | question_id | 关联interview_questions.question_id，级联删除 |
| 索引 | idx_session_id | session_id | 支持按会话查询回答 |
| 索引 | idx_question_id | question_id | 支持按题目查询回答 |
| 索引 | idx_overall_score | overall_score | 支持按分数排序 |
| 索引 | idx_submitted_at | submitted_at | 支持按提交时间排序 |

---

## 数据库设计总览

### 数据库表关系图

**简历分析数据库 (interview_analysis)**:

| 表名 | 中文名 | 主要功能 | 关联关系 |
|------|--------|----------|----------|
| users | 用户认证表 | 存储用户认证信息 | 通过user_id关联candidate_profiles |
| candidate_profiles | 候选人档案主表 | 存储候选人基本信息 | 一对多关联其他表 |
| work_experiences | 工作经验表 | 存储工作经历详情 | 多对一关联candidate_profiles |
| projects | 项目经验表 | 存储项目经历详情 | 多对一关联candidate_profiles |
| technical_skills | 技术技能表 | 存储技术技能详情 | 多对一关联candidate_profiles |

**面试记录数据库 (interview_service)**:

| 表名 | 中文名 | 主要功能 | 关联关系 |
|------|--------|----------|----------|
| interview_sessions | 面试会话主表 | 存储面试会话信息 | 一对多关联题目和回答 |
| interview_questions | 面试题目表 | 存储面试题目详情 | 多对一关联interview_sessions |
| interview_answers | 面试回答表 | 存储回答和评分详情 | 多对一关联sessions和questions |

---

## 数据库设计特点

### 1. 数据一致性保证

| 特点 | 实现方式 | 说明 |
|------|----------|------|
| 外键约束 | FOREIGN KEY | 确保数据完整性，防止孤立数据 |
| 级联删除 | ON DELETE CASCADE | 删除主记录时自动删除关联记录 |
| 唯一约束 | UNIQUE INDEX | 防止重复数据，如user_id、session_id |
| 非空约束 | NOT NULL | 确保关键字段不为空 |

### 2. 查询性能优化

| 索引类型 | 应用场景 | 覆盖字段 |
|----------|----------|----------|
| 主键索引 | 唯一标识记录 | 所有表的id字段 |
| 唯一索引 | 业务唯一性 | user_id, session_id, question_id等 |
| 普通索引 | 常用查询条件 | name, status, session_type等 |
| 复合索引 | 多字段查询 | (user_id, created_at)等 |

### 3. 数据类型设计

| 数据类型 | 使用场景 | 设计考虑 |
|----------|----------|----------|
| BIGINT | 主键ID | 支持大数据量，自增长 |
| VARCHAR | 短文本 | 根据实际需求设置长度 |
| TEXT | 长文本 | 存储描述、反馈等内容 |
| DECIMAL(3,1) | 评分字段 | 精确到小数点后1位 |
| TIMESTAMP | 时间字段 | 自动维护创建和更新时间 |
| BOOLEAN | 布尔值 | 是否必答等标志位 |

### 4. 扩展性设计

| 扩展方式 | 实现方法 | 应用场景 |
|----------|----------|----------|
| JSON字段 | TEXT类型存储JSON | 复杂结构数据，如技能列表 |
| 排序字段 | sort_order | 支持自定义显示顺序 |
| 状态字段 | 枚举值设计 | 支持业务流程状态管理 |
| 预留字段 | 适当冗余设计 | 便于功能升级扩展 |

### 5. 业务逻辑支持

| 业务场景 | 数据库支持 | 实现方式 |
|----------|------------|----------|
| 四种面试类型 | session_type枚举 | knowledge_based等4种类型 |
| 多维度评分 | 多个评分字段 | technical_accuracy等细分评分 |
| 完整业务流程 | status状态管理 | pending→in_progress→completed |
| 数据统计分析 | 聚合字段设计 | total_questions, average_score等 |

---

## 开发历程

- **[001]** 微服务架构重构详细计划
- **[002]** MongoDB到MySQL迁移详细计划
- **[003]** 完整服务链路测试详细计划
- **[004]** 面试记录服务启动和健康测试详细计划
- **[005]** 服务器部署配置修改详细计划
- **[007]** 错题集功能开发详细计划（已完成）
- **[008]** 用户管理系统开发详细计划（已完成）
- **[012]** 简历分析服务字段扩展详细计划（已完成）

---

**文档位置**: `project_document/[001]数据库设计文档.md`
