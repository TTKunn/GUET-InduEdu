# [000]AI智能面试官项目完整指南

## 项目概述
AI智能面试官项目是一个基于微服务架构的智能面试系统，旨在为Dify工作流提供完整的面试管理解决方案。项目采用现代化的技术栈，包含简历解析、内容分析、向量存储和面试记录等核心功能模块，已成功部署到生产服务器并支持外部API访问。

### 项目特点与内容
- 5个独立的微服务，便于维护和扩展
- 集成LLM进行简历内容智能分析
- 支持语义搜索和相似度匹配
- 为Dify工作流设计了API接口
- 完整的用户认证和权限管理
- 本地数据库连接


## 服务架构

### 微服务列表
1. **PDF解析服务** (端口8003) - 解析简历PDF文件
2. **简历分析服务** (端口8004) - 使用LLM分析简历内容，支持8个扩展字段提取
3. **向量存储服务** (端口8005) - 向量化存储和检索
4. **面试记录服务** (端口8006) - 面试记录管理（主要服务）
5. **用户认证服务** (端口8007) - 用户注册、登录、JWT认证管理

### 技术栈
- **后端框架**: FastAPI + Python 3.10+
- **数据库**: MySQL 8.0 + Milvus 2.3+
- **LLM服务**: 智谱AI GLM-4
- **PDF处理**: PyMuPDF + pdfplumber
- **向量化**: sentence-transformers
- **部署方式**: 直接运行（非Docker）
- **API文档**: Swagger/OpenAPI 3.0

### 项目结构
```
GUET-InduEdu/interviewer/test/
├── pdf-parser-service/          # PDF解析服务
├── analysis-service/            # 简历分析服务
├── vector-storage-service/      # 向量存储服务
├── interview-service/           # 面试记录服务
├── user-auth-service/           # 用户认证服务
└── project_document/           # 项目文档
```

### 开发历程
- **[001]** 微服务架构重构详细计划
- **[002]** MongoDB到MySQL迁移详细计划
- **[003]** 完整服务链路测试详细计划
- **[004]** 面试记录服务启动和健康测试详细计划
- **[005]** 服务器部署配置修改详细计划
- **[007]** 错题集功能开发详细计划（已完成）
- **[008]** 用户管理系统开发详细计划（已完成）
- **[012]** 简历分析服务字段扩展详细计划（已完成）

---

## MySQL数据库核心设计

### 数据库架构概述
项目采用MySQL 8.0作为主要数据存储，设计了三个核心数据库：
- **interview_analysis**: 简历分析相关数据（包含用户认证表）
- **interview_service**: 面试记录相关数据
- **用户认证系统**: 复用interview_analysis数据库，通过user_id字段关联

### 简历分析数据库 (interview_analysis)

#### users 表 - 用户认证主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(36) | 是 | - | 用户UUID，唯一标识 |
| username | VARCHAR(50) | 是 | - | 用户名，唯一 |
| email | VARCHAR(100) | 是 | - | 邮箱地址，唯一 |
| password_hash | VARCHAR(255) | 是 | - | 密码哈希值（bcrypt） |
| is_active | BOOLEAN | 是 | TRUE | 是否激活 |
| is_verified | BOOLEAN | 是 | FALSE | 是否验证邮箱 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| last_login_at | TIMESTAMP | 否 | NULL | 最后登录时间 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | user_id | 唯一索引 | 确保用户UUID唯一 |
| UNIQUE | username | 唯一索引 | 确保用户名唯一 |
| UNIQUE | email | 唯一索引 | 确保邮箱唯一 |
| idx_is_active | is_active | 普通索引 | 支持按激活状态筛选 |
| idx_created_at | created_at | 普通索引 | 支持按创建时间排序 |

**关联关系**:
- 通过 `user_id` 字段与 `candidate_profiles` 表关联
- 一个用户对应一个候选人档案（1:1关系）
- 支持用户注册后逐步完善简历信息

**数据迁移说明**:
- **迁移时间**: 2025-09-10 21:25:27
- **迁移数量**: 15个现有用户成功迁移
- **默认密码**: 123456 (bcrypt加密存储)
- **迁移策略**: 从candidate_profiles表同步用户基本信息到users表
- **密码安全**: 使用bcrypt算法，每次加密产生不同哈希值，防彩虹表攻击
- **关联验证**: 所有迁移用户均可正常登录，两表关联关系正确

#### candidate_profiles 表 - 候选人档案主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户唯一标识，UNIQUE约束 |
| name | VARCHAR(100) | 否 | NULL | 姓名 |
| phone | VARCHAR(20) | 否 | NULL | 电话号码 |
| email | VARCHAR(100) | 否 | NULL | 邮箱地址 |
| location | VARCHAR(200) | 否 | NULL | 居住地址 |
| education | TEXT | 否 | NULL | 教育背景描述 |
| direction | VARCHAR(100) | 否 | NULL | 技术发展方向 |
| total_experience_years | INTEGER | 否 | NULL | 总工作年限 |
| skill_level | VARCHAR(50) | 否 | NULL | 技能水平等级 |
| technical_skills_json | TEXT | 否 | NULL | 技术技能JSON存储 |
| projects_keywords_json | TEXT | 否 | NULL | 项目关键词JSON存储 |
| education_json | TEXT | 否 | NULL | 教育背景JSON存储 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | user_id | 唯一索引 | 确保用户ID唯一 |
| idx_name | name | 普通索引 | 支持按姓名查询 |
| idx_skill_level | skill_level | 普通索引 | 支持按技能等级筛选 |

#### work_experiences 表 - 工作经验表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| company | VARCHAR(200) | 否 | NULL | 公司名称 |
| position | VARCHAR(100) | 否 | NULL | 职位名称 |
| start_date | VARCHAR(50) | 否 | NULL | 开始时间 |
| end_date | VARCHAR(50) | 否 | NULL | 结束时间 |
| description | TEXT | 否 | NULL | 工作内容描述 |
| technologies | TEXT | 否 | NULL | 使用的技术栈 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询工作经验 |

#### projects 表 - 项目经验表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| name | VARCHAR(200) | 是 | - | 项目名称 |
| description | TEXT | 否 | NULL | 项目详细描述 |
| technologies | TEXT | 否 | NULL | 项目使用的技术栈 |
| role | VARCHAR(100) | 否 | NULL | 在项目中担任的角色 |
| achievements | TEXT | 否 | NULL | 项目成果和收获 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询项目经验 |
| 索引 | idx_name | name | 支持按项目名称查询 |

#### technical_skills 表 - 技术技能表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID，外键关联candidate_profiles |
| skill_name | VARCHAR(100) | 是 | - | 技能名称（如Python、Java等） |
| skill_category | VARCHAR(50) | 否 | NULL | 技能分类（编程语言、框架、数据库等） |
| proficiency_level | VARCHAR(20) | 否 | NULL | 熟练程度（初级、中级、高级、专家） |
| years_of_experience | INTEGER | 否 | NULL | 使用该技能的年限 |
| sort_order | INTEGER | 否 | 0 | 显示排序 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 外键 | FK_user_id | user_id | 关联candidate_profiles.user_id，级联删除 |
| 索引 | idx_user_id | user_id | 支持按用户查询技能 |
| 索引 | idx_skill_name | skill_name | 支持按技能名称查询 |
| 索引 | idx_skill_category | skill_category | 支持按技能分类筛选 |

### 面试记录数据库 (interview_service)

#### interview_sessions 表 - 面试会话主表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| user_id | VARCHAR(100) | 是 | - | 用户ID |
| session_id | VARCHAR(100) | 是 | - | 会话唯一标识，UNIQUE约束 |
| session_name | VARCHAR(200) | 否 | NULL | 面试名称 |
| session_type | VARCHAR(50) | 否 | 'knowledge_based' | 面试类型 |
| status | VARCHAR(20) | 否 | 'pending' | 会话状态 |
| difficulty_level | VARCHAR(20) | 否 | 'medium' | 面试难度 |
| estimated_duration | INTEGER | 否 | 60 | 预计时长(分钟) |
| actual_duration | INTEGER | 否 | NULL | 实际时长(分钟) |
| start_time | TIMESTAMP | 否 | NULL | 开始时间 |
| end_time | TIMESTAMP | 否 | NULL | 结束时间 |
| total_questions | INTEGER | 否 | 0 | 总题目数 |
| completed_questions | INTEGER | 否 | 0 | 已完成题目数 |
| average_score | DECIMAL(3,1) | 否 | NULL | 平均分数 |
| interviewer_notes | TEXT | 否 | NULL | 面试官备注 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| session_type | knowledge_based | 自选知识点面试 |
|  | company_position | 自选公司岗位面试 |
|  | resume_customized | 个人简历定制面试 |
|  | wrong_questions | 错题面试 |
| status | pending | 待开始 |
|  | in_progress | 进行中 |
|  | completed | 已完成 |
|  | cancelled | 已取消 |
| difficulty_level | easy | 简单 |
|  | medium | 中等 |
|  | hard | 困难 |

**索引设计**:

| 索引名 | 索引字段 | 索引类型 | 说明 |
|--------|----------|----------|------|
| PRIMARY | id | 主键索引 | 主键自动创建 |
| UNIQUE | session_id | 唯一索引 | 确保会话ID唯一 |
| idx_user_id | user_id | 普通索引 | 支持按用户查询会话 |
| idx_status | status | 普通索引 | 支持按状态筛选 |
| idx_session_type | session_type | 普通索引 | 支持按面试类型筛选 |
| idx_created_at | created_at | 普通索引 | 支持按创建时间排序 |

#### interview_questions 表 - 面试题目表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| session_id | VARCHAR(100) | 是 | - | 会话ID，外键关联interview_sessions |
| question_id | VARCHAR(150) | 是 | - | 题目唯一标识，UNIQUE约束 |
| question_text | TEXT | 是 | - | 题目内容 |
| question_type | VARCHAR(50) | 是 | - | 题目类型 |
| question_category | VARCHAR(100) | 否 | NULL | 题目分类 |
| difficulty_level | VARCHAR(20) | 否 | NULL | 题目难度 |
| expected_duration | INTEGER | 否 | NULL | 预期回答时长(分钟) |
| reference_answer | TEXT | 否 | NULL | 参考答案 |
| scoring_criteria | TEXT | 否 | NULL | 评分标准 |
| sort_order | INTEGER | 否 | 0 | 排序 |
| is_required | BOOLEAN | 否 | TRUE | 是否必答 |
| created_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 创建时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| question_type | technical | 技术题 |
|  | behavioral | 行为题 |
|  | logical | 逻辑题 |
|  | project_based | 项目题 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 唯一 | UNIQUE | question_id | 确保题目ID唯一 |
| 外键 | FK_session_id | session_id | 关联interview_sessions.session_id，级联删除 |
| 索引 | idx_session_id | session_id | 支持按会话查询题目 |
| 索引 | idx_question_type | question_type | 支持按题目类型筛选 |
| 索引 | idx_sort_order | sort_order | 支持按排序查询 |

#### interview_answers 表 - 面试回答表

**字段说明**:

| 字段名 | 数据类型 | 是否必填 | 默认值 | 说明 |
|--------|----------|----------|--------|------|
| id | BIGINT | 是 | AUTO_INCREMENT | 自增主键 |
| session_id | VARCHAR(100) | 是 | - | 会话ID，外键关联interview_sessions |
| question_id | VARCHAR(150) | 是 | - | 题目ID，外键关联interview_questions |
| answer_id | VARCHAR(200) | 是 | - | 回答唯一标识，UNIQUE约束 |
| candidate_answer | TEXT | 是 | - | 候选人回答内容 |
| answer_duration | INTEGER | 否 | NULL | 回答时长(秒) |
| status | VARCHAR(20) | 否 | 'answered' | 回答状态 |
| interviewer_feedback | TEXT | 是 | - | 面试官反馈 |
| technical_accuracy | DECIMAL(3,1) | 否 | NULL | 技术准确性评分(0-10) |
| communication_clarity | DECIMAL(3,1) | 否 | NULL | 表达清晰度评分(0-10) |
| problem_solving | DECIMAL(3,1) | 否 | NULL | 问题解决能力评分(0-10) |
| overall_score | DECIMAL(3,1) | 是 | - | 综合评分(0-10) |
| answer_quality | VARCHAR(20) | 否 | NULL | 回答质量等级 |
| submitted_at | TIMESTAMP | 是 | CURRENT_TIMESTAMP | 提交时间 |
| reviewed_at | TIMESTAMP | 否 | NULL | 评审时间 |

**枚举值说明**:

| 字段 | 可选值 | 说明 |
|------|--------|------|
| status | answered | 已回答 |
|  | reviewing | 评审中 |
|  | reviewed | 已评审 |
| answer_quality | excellent | 优秀 |
|  | good | 良好 |
|  | average | 一般 |
|  | poor | 较差 |

**索引和约束**:

| 类型 | 名称 | 字段 | 说明 |
|------|------|------|------|
| 主键 | PRIMARY | id | 主键索引 |
| 唯一 | UNIQUE | answer_id | 确保回答ID唯一 |
| 外键 | FK_session_id | session_id | 关联interview_sessions.session_id，级联删除 |
| 外键 | FK_question_id | question_id | 关联interview_questions.question_id，级联删除 |
| 索引 | idx_session_id | session_id | 支持按会话查询回答 |
| 索引 | idx_question_id | question_id | 支持按题目查询回答 |
| 索引 | idx_overall_score | overall_score | 支持按分数排序 |
| 索引 | idx_submitted_at | submitted_at | 支持按提交时间排序 |

### 数据库设计总览

#### 数据库表关系图

**简历分析数据库 (interview_analysis)**:

| 表名 | 中文名 | 主要功能 | 关联关系 |
|------|--------|----------|----------|
| candidate_profiles | 候选人档案主表 | 存储候选人基本信息 | 一对多关联其他表 |
| work_experiences | 工作经验表 | 存储工作经历详情 | 多对一关联candidate_profiles |
| projects | 项目经验表 | 存储项目经历详情 | 多对一关联candidate_profiles |
| technical_skills | 技术技能表 | 存储技术技能详情 | 多对一关联candidate_profiles |

**面试记录数据库 (interview_service)**:

| 表名 | 中文名 | 主要功能 | 关联关系 |
|------|--------|----------|----------|
| interview_sessions | 面试会话主表 | 存储面试会话信息 | 一对多关联题目和回答 |
| interview_questions | 面试题目表 | 存储面试题目详情 | 多对一关联interview_sessions |
| interview_answers | 面试回答表 | 存储回答和评分详情 | 多对一关联sessions和questions |

#### 数据库设计特点

**1. 数据一致性保证**

| 特点 | 实现方式 | 说明 |
|------|----------|------|
| 外键约束 | FOREIGN KEY | 确保数据完整性，防止孤立数据 |
| 级联删除 | ON DELETE CASCADE | 删除主记录时自动删除关联记录 |
| 唯一约束 | UNIQUE INDEX | 防止重复数据，如user_id、session_id |
| 非空约束 | NOT NULL | 确保关键字段不为空 |

**2. 查询性能优化**

| 索引类型 | 应用场景 | 覆盖字段 |
|----------|----------|----------|
| 主键索引 | 唯一标识记录 | 所有表的id字段 |
| 唯一索引 | 业务唯一性 | user_id, session_id, question_id等 |
| 普通索引 | 常用查询条件 | name, status, session_type等 |
| 复合索引 | 多字段查询 | (user_id, created_at)等 |

**3. 数据类型设计**

| 数据类型 | 使用场景 | 设计考虑 |
|----------|----------|----------|
| BIGINT | 主键ID | 支持大数据量，自增长 |
| VARCHAR | 短文本 | 根据实际需求设置长度 |
| TEXT | 长文本 | 存储描述、反馈等内容 |
| DECIMAL(3,1) | 评分字段 | 精确到小数点后1位 |
| TIMESTAMP | 时间字段 | 自动维护创建和更新时间 |
| BOOLEAN | 布尔值 | 是否必答等标志位 |

**4. 扩展性设计**

| 扩展方式 | 实现方法 | 应用场景 |
|----------|----------|----------|
| JSON字段 | TEXT类型存储JSON | 复杂结构数据，如技能列表 |
| 排序字段 | sort_order | 支持自定义显示顺序 |
| 状态字段 | 枚举值设计 | 支持业务流程状态管理 |
| 预留字段 | 适当冗余设计 | 便于功能升级扩展 |

**5. 业务逻辑支持**

| 业务场景 | 数据库支持 | 实现方式 |
|----------|------------|----------|
| 四种面试类型 | session_type枚举 | knowledge_based等4种类型 |
| 多维度评分 | 多个评分字段 | technical_accuracy等细分评分 |
| 完整业务流程 | status状态管理 | pending→in_progress→completed |
| 数据统计分析 | 聚合字段设计 | total_questions, average_score等 |

---

## 服务器部署配置

### 部署环境
- **服务器IP**: 43.142.157.145
- **操作系统**: Ubuntu
- **数据库**: MySQL和Milvus均在本服务器运行

### 核心配置修改
为了支持外部API访问，已完成以下配置修改：

#### 1. 数据库连接配置
- **MySQL连接**: 使用localhost:3306（性能最佳）
- **Milvus连接**: 使用localhost:19530
- **优势**: 本地连接延迟最低，安全性最高

#### 2. API服务配置
- **绑定地址**: 所有服务使用0.0.0.0绑定，支持外部访问
- **端口配置**: 8003-8006端口开放
- **跨域配置**: 允许所有来源访问

#### 3. 服务间调用配置
- interview-service调用analysis-service: localhost:8004
- analysis-service调用pdf-parser-service: localhost:8003
- 所有服务间调用使用localhost，确保高效通信

---

## 服务启动指南

### 启动顺序（重要）
按以下顺序启动服务以确保依赖关系正确：

#### 1. 启动PDF解析服务
```bash
cd /home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/pdf-parser-service
python3 main.py
```
**验证**: `curl http://localhost:8003/health`

#### 2. 启动简历分析服务
```bash
cd /home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/analysis-service
python3 main.py
```
**验证**: `curl http://localhost:8004/health`

#### 3. 启动向量存储服务
```bash
cd /home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/vector-storage-service
python3 main.py
```
**验证**: `curl http://localhost:8005/health`

#### 4. 启动面试记录服务
```bash
cd /home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/interview-service
python3 main.py
```
**验证**: `curl http://localhost:8006/health`

#### 5. 启动用户认证服务
```bash
cd /home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/user-auth-service
./start.sh
# 或者直接运行
# python3 main.py
```
**验证**: `curl http://localhost:8007/health`

### 服务状态检查
所有服务启动后，可通过以下地址检查状态：
- PDF解析服务: http://43.142.157.145:8003/health
- 简历分析服务: http://43.142.157.145:8004/health
- 向量存储服务: http://43.142.157.145:8005/health
- 面试记录服务: http://43.142.157.145:8006/health
- 用户认证服务: http://43.142.157.145:8007/health

---

## 各服务API调用详细说明

### PDF解析服务 (端口8003)

**基础信息**:
- 服务地址: http://43.142.157.145:8003
- 在线文档: http://43.142.157.145:8003/docs
- 主要功能: PDF文件解析、文本提取、文档分块

**接口列表**:
- `GET /health` - 健康检查 - 检查PDF解析服务运行状态和系统资源
- `POST /parse` - 解析PDF文件（完整结构化数据） - 解析PDF文件并返回完整的结构化数据和元数据
- `POST /parse-text` - 解析PDF文件（纯文本） - 解析PDF文件并返回纯文本内容，适用于简单文本提取
- `POST /parse-and-store` - 解析并存储PDF文件 - 解析PDF文件并直接存储到向量数据库
- `GET /search` - 搜索文档 - 在已存储的PDF文档中进行语义搜索

#### 1. 健康检查
**URL**: `GET http://43.142.157.145:8003/health`

**功能介绍**: 检查PDF解析服务运行状态和系统资源

**参数**: 无

**返回格式**:
```json
{
  "status": "healthy",
  "service": "pdf-parser-service",
  "version": "1.0.0",
  "timestamp": "2025-09-05T21:00:44.514264"
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8003/health
```

#### 2. 解析PDF文件（完整）
**URL**: `POST http://43.142.157.145:8003/parse`

**功能介绍**: 解析PDF文件并返回完整的结构化数据和元数据

**参数规范**:
- `file` (文件, 必填): PDF文件，最大10MB
- `chunk_size` (整数, 可选): 文档分块大小，范围100-5000，默认1000
- `chunk_overlap` (整数, 可选): 分块重叠大小，范围0-1000，默认200
- `split_text` (布尔, 可选): 是否进行文本分块，默认true
- `return_content` (布尔, 可选): 是否返回解析内容，默认false

**返回格式**:
```json
{
  "success": true,
  "task_id": "uuid-string",
  "file_name": "resume.pdf",
  "file_size": 245760,
  "page_count": 2,
  "chunk_count": 5,
  "extracted_content": {
    "text": "完整文本内容...",
    "chunks": ["分块1", "分块2"],
    "metadata": {
      "title": "简历",
      "author": "张三"
    }
  },
  "processing_time": 1.23,
  "message": "解析完成"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8003/parse" \
  -F "file=@/path/to/resume.pdf" \
  -F "chunk_size=1000" \
  -F "chunk_overlap=200" \
  -F "split_text=true" \
  -F "return_content=true"
```

#### 3. 解析PDF文件（纯文本）
**URL**: `POST http://43.142.157.145:8003/parse-text`

**功能介绍**: 解析PDF文件并返回纯文本内容，适用于简单文本提取

**参数规范**:
- `file` (文件, 必填): PDF文件，最大10MB
- `chunk_size` (整数, 可选): 文档分块大小，默认1000
- `chunk_overlap` (整数, 可选): 分块重叠大小，默认200
- `split_text` (布尔, 可选): 是否进行文本分块，默认true

**返回格式**:
```json
{
  "success": true,
  "message": "PDF文本解析成功",
  "task_id": "uuid-string",
  "text_content": "提取的纯文本内容...",
  "total_chars": 12345,
  "processing_time": 0.89
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8003/parse-text" \
  -F "file=@/path/to/resume.pdf" \
  -F "split_text=true"
```

#### 4. 解析并存储PDF文件
**URL**: `POST http://43.142.157.145:8003/parse-and-store`

**功能介绍**: 解析PDF文件并直接存储到向量数据库

**参数规范**:
- `file` (文件, 必填): PDF文件，最大10MB
- `collection_name` (字符串, 可选): Milvus集合名称，默认"pdf_documents"
- `chunk_size` (整数, 可选): 文档分块大小，范围100-5000，默认1000
- `chunk_overlap` (整数, 可选): 分块重叠大小，范围0-1000，默认200
- `embedding_model` (字符串, 可选): 嵌入模型类型，默认"zhipuai"

**返回格式**:
```json
{
  "success": true,
  "message": "PDF解析并存储成功",
  "task_id": "uuid-string",
  "total_documents": 5,
  "total_chars": 12345,
  "avg_chars": 2469.0,
  "total_pages": 2,
  "processing_time": 2.34,
  "documents": null
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8003/parse-and-store" \
  -F "file=@/path/to/resume.pdf" \
  -F "collection_name=resume_collection" \
  -F "embedding_model=zhipuai"
```

#### 5. 搜索文档
**URL**: `GET http://43.142.157.145:8003/search`

**功能介绍**: 在已存储的PDF文档中进行语义搜索

**参数规范**:
- `query` (字符串, 必填): 搜索查询文本
- `collection_name` (字符串, 可选): Milvus集合名称，默认"pdf_documents"
- `k` (整数, 可选): 返回结果数量，默认5
- `embedding_model` (字符串, 可选): 嵌入模型类型，默认"zhipuai"

**返回格式**:
```json
{
  "success": true,
  "query": "Python开发经验",
  "results": [
    {
      "content": "具有3年Python开发经验...",
      "score": 0.95,
      "metadata": {"page": 1, "chunk_id": "chunk_001"}
    }
  ],
  "total_results": 1,
  "collection_name": "pdf_documents",
  "processing_time": 0.67
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8003/search?query=Python开发经验&k=5&collection_name=resume_collection"
```

---

### 简历分析服务 (端口8004)

**基础信息**:
- 服务地址: http://43.142.157.145:8004
- 在线文档: http://43.142.157.145:8004/docs
- 主要功能: 简历内容分析、关键信息提取、LLM结构化处理、8个扩展字段提取

**接口列表**:
- `GET /health` - 健康检查 - 检查简历分析服务状态、数据库连接和LLM服务可用性
- `POST /analyze` - 分析简历文件 - 使用LLM分析简历内容并提取结构化信息存储到数据库
- `POST /keywords` - 获取用户关键词 - 从用户档案中提取技术技能和项目关键词
- `GET /keywords/grouped/{user_id}` - 获取Dify格式关键词（重要） - 为Dify工作流提供格式化的关键词数据
- `POST /profile` - 查询用户档案 - 获取用户完整的简历分析档案信息
- `GET /analyze/status/{user_id}` - 查询分析状态 - 检查用户简历分析处理状态
- `POST /parse-pdf` - 仅解析PDF文件 - 调用PDF解析服务获取文本内容，不进行分析

#### 1. 健康检查
**URL**: `GET http://43.142.157.145:8004/health`

**功能介绍**: 检查简历分析服务状态、数据库连接和LLM服务可用性

**参数**: 无

**返回格式**:
```json
{
  "status": "healthy",
  "timestamp": "2025-09-05T21:01:12.508724",
  "version": "1.0.0",
  "database_connected": true,
  "llm_available": true,
  "dependencies": {
    "mysql": "connected",
    "llm_service": "zhipuai",
    "pdf_parser_service": "available"
  },
  "stats": {
    "total_profiles": 15,
    "database_status": "connected",
    "llm_provider": "zhipuai"
  }
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8004/health
```

#### 2. 分析简历文件
**URL**: `POST http://43.142.157.145:8004/analyze`

**功能介绍**: 使用LLM分析简历内容并提取结构化信息存储到数据库

**参数规范**:
- `user_id` (字符串, 必填): 用户唯一标识符
- `file` (文件, 必填): PDF简历文件
- `extraction_mode` (字符串, 可选): 提取模式，可选值comprehensive/basic，默认comprehensive
- `overwrite` (布尔, 可选): 是否覆盖已存在的档案，默认true

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "message": "简历分析完成",
  "profile": {
    "user_id": "user_001",
    "personal_info": {
      "name": "张三",
      "phone": "13800138000",
      "email": "zhangsan@example.com",
      "location": "北京市",
      "age": 25,
      "gender": "男",
      "ethnicity": "汉族",
      "political_status": "共青团员",
      "university": "清华大学",
      "major": "计算机科学与技术"
    },
    "technical_skills": ["Python", "Java", "MySQL"],
    "projects_keywords": [
      {
        "project_name": "电商系统",
        "keywords": ["Spring Boot", "MySQL"]
      }
    ],
    "direction": "后端开发",
    "work_experience_detail": [
      {
        "title": "高级后端开发工程师 - 腾讯科技",
        "content": "负责微服务架构设计与实现，使用Spring Boot开发高并发系统..."
      }
    ],
    "project_experience_detail": [
      {
        "title": "分布式电商系统",
        "content": "基于Spring Cloud微服务架构，实现了用户管理、订单处理、支付系统等核心功能..."
      }
    ]
  },
  "technical_skills": ["Python", "Java", "MySQL"],
  "projects_keywords": [...],
  "direction": "后端开发",
  "processing_time": 34.51
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8004/analyze" \
  -F "user_id=user_001" \
  -F "file=@/path/to/resume.pdf" \
  -F "extraction_mode=comprehensive" \
  -F "overwrite=true"
```

#### 3. 获取Dify格式关键词（重要）
**URL**: `GET http://43.142.157.145:8004/keywords/grouped/{user_id}`

**功能介绍**: 为Dify工作流提供格式化的关键词数据

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "technical_skills": ["Python", "Java", "MySQL"],
  "technical_skills_text": "Python, Java, MySQL",
  "projects_keywords": [
    {
      "project_name": "电商系统",
      "keywords": ["Spring Boot", "MySQL", "后端开发"],
      "keywords_text": "Spring Boot, MySQL, 后端开发",
      "search_text": "电商系统 Spring Boot MySQL 后端开发"
    }
  ],
  "direction": "后端开发",
  "dify_usage_guide": {
    "technical_skills": "技术技能列表，可以整体检索或分组检索",
    "projects": "每个项目单独检索，使用search_text字段作为检索内容",
    "direction": "个人技术方向，用于专门的方向检索"
  },
  "message": "Dify关键词获取成功"
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8004/keywords/grouped/user_001
```

#### 4. 获取用户关键词
**URL**: `POST http://43.142.157.145:8004/keywords`

**功能介绍**: 从用户档案中提取技术技能和项目关键词

**参数规范**:
```json
{
  "user_id": "user_001",
  "category": "all",
  "format_type": "string"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8004/keywords" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "category": "all",
    "format_type": "string"
  }'
```

#### 5. 查询用户档案
**URL**: `POST http://43.142.157.145:8004/profile`

**功能介绍**: 获取用户完整的简历分析档案信息

**参数规范**:
```json
{
  "user_id": "user_001",
  "include_keywords": true
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8004/profile" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "include_keywords": true
  }'
```

#### 6. 查询分析状态
**URL**: `GET http://43.142.157.145:8004/analyze/status/{user_id}`

**功能介绍**: 检查用户简历分析处理状态

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符

**返回格式**:
```json
{
  "user_id": "user_001",
  "status": "completed",
  "message": "分析已完成"
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8004/analyze/status/user_001
```

#### 7. 仅解析PDF文件
**URL**: `POST http://43.142.157.145:8004/parse-pdf`

**功能介绍**: 调用PDF解析服务获取文本内容，不进行分析

**参数规范**:
- `file` (文件, 必填): PDF文件

**返回格式**:
```json
{
  "success": true,
  "filename": "resume.pdf",
  "text_content": "提取的PDF文本内容...",
  "content_length": 1234,
  "message": "PDF解析成功"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8004/parse-pdf" \
  -F "file=@/path/to/resume.pdf"
```

---

### 向量存储服务 (端口8005)

**基础信息**:
- 服务地址: http://43.142.157.145:8005
- 在线文档: http://43.142.157.145:8005/docs
- 主要功能: 向量化存储、语义搜索、文档管理

**接口列表**:
- `GET /health` - 健康检查 - 检查向量存储服务状态和Milvus数据库连接
- `POST /store` - 存储文本向量 - 将文本列表转换为向量并存储到指定集合
- `POST /store-documents` - 存储文档向量 - 将文档对象转换为向量并存储，支持元数据
- `POST /search` - 向量相似性搜索 - 基于查询文本进行语义相似度搜索
- `GET /collections/{collection_name}/stats` - 获取集合统计信息 - 查看指定集合的文档数量和状态
- `DELETE /collections/{collection_name}` - 删除集合 - 删除指定的向量集合及其所有数据

#### 1. 健康检查
**URL**: `GET http://43.142.157.145:8005/health`

**功能介绍**: 检查向量存储服务状态和Milvus数据库连接

**参数**: 无

**返回格式**:
```json
{
  "status": "healthy",
  "service": "vector-storage-service",
  "version": "1.0.0",
  "timestamp": "2025-09-05T21:01:39.151967",
  "milvus_connected": true
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8005/health
```

#### 2. 存储文本向量
**URL**: `POST http://43.142.157.145:8005/store`

**功能介绍**: 将文本列表转换为向量并存储到指定集合

**参数规范**:
```json
{
  "collection_name": "resume_collection",
  "texts": ["文本内容1", "文本内容2"],
  "metadatas": [
    {"user_id": "user_001", "type": "skill"},
    {"user_id": "user_001", "type": "project"}
  ],
  "embedding_model": "zhipuai"
}
```

**返回格式**:
```json
{
  "success": true,
  "message": "文本存储成功",
  "collection_name": "resume_collection",
  "stored_count": 2,
  "processing_time": 1.23
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8005/store" \
  -H "Content-Type: application/json" \
  -d '{
    "collection_name": "resume_collection",
    "texts": ["Python开发工程师，3年经验"],
    "metadatas": [{"user_id": "user_001", "type": "experience"}],
    "embedding_model": "zhipuai"
  }'
```

#### 3. 存储文档向量
**URL**: `POST http://43.142.157.145:8005/store-documents`

**功能介绍**: 将文档对象转换为向量并存储，支持元数据

**参数规范**:
```json
{
  "documents": [
    {
      "content": "文档内容",
      "metadata": {"type": "resume", "user_id": "user_001"}
    }
  ],
  "collection_name": "document_collection",
  "embedding_model": "zhipuai"
}
```

**返回格式**:
```json
{
  "success": true,
  "message": "文档存储成功",
  "collection_name": "document_collection",
  "stored_count": 1,
  "processing_time": 1.45
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8005/store-documents" \
  -H "Content-Type: application/json" \
  -d '{
    "documents": [
      {
        "content": "Python开发工程师，具有3年经验",
        "metadata": {"type": "skill", "user_id": "user_001"}
      }
    ],
    "collection_name": "resume_collection",
    "embedding_model": "zhipuai"
  }'
```

#### 4. 向量相似性搜索
**URL**: `POST http://43.142.157.145:8005/search`

**功能介绍**: 基于查询文本进行语义相似度搜索

**参数规范**:
```json
{
  "collection_name": "resume_collection",
  "query": "Python后端开发",
  "k": 5,
  "embedding_model": "zhipuai",
  "with_score": true,
  "filter_expr": "user_id == 'user_001'"
}
```

**返回格式**:
```json
{
  "success": true,
  "message": "搜索完成",
  "collection_name": "resume_collection",
  "query": "Python后端开发",
  "results": [
    {
      "content": "Python开发工程师，3年经验",
      "metadata": {"user_id": "user_001", "type": "experience"},
      "score": 0.95
    }
  ],
  "total_results": 1,
  "processing_time": 0.45
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8005/search" \
  -H "Content-Type: application/json" \
  -d '{
    "collection_name": "resume_collection",
    "query": "Python后端开发",
    "k": 5,
    "with_score": true
  }'
```

#### 5. 获取集合统计信息
**URL**: `GET http://43.142.157.145:8005/collections/{collection_name}/stats`

**功能介绍**: 查看指定集合的文档数量和状态

**参数规范**:
- `collection_name` (路径参数, 必填): 集合名称
- `embedding_model` (查询参数, 可选): 嵌入模型类型，默认"zhipuai"

**返回格式**:
```json
{
  "success": true,
  "collection_name": "resume_collection",
  "exists": true,
  "row_count": 150,
  "embedding_model": "zhipuai"
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8005/collections/resume_collection/stats?embedding_model=zhipuai"
```

#### 6. 删除集合
**URL**: `DELETE http://43.142.157.145:8005/collections/{collection_name}`

**功能介绍**: 删除指定的向量集合及其所有数据

**参数规范**:
- `collection_name` (路径参数, 必填): 集合名称
- `embedding_model` (查询参数, 可选): 嵌入模型类型，默认"zhipuai"

**返回格式**:
```json
{
  "success": true,
  "message": "集合 resume_collection 已删除"
}
```

**使用示例**:
```bash
curl -X DELETE "http://43.142.157.145:8005/collections/resume_collection?embedding_model=zhipuai"
```

---

### 面试记录服务 (端口8006)

**基础信息**:
- 服务地址: http://43.142.157.145:8006
- 在线文档: http://43.142.157.145:8006/docs
- 主要功能: 面试会话管理、题目记录、评分统计

**接口列表**:

**Dify专用接口（主要使用）**:
- `GET /health` - 健康检查 - 检查面试记录服务状态、数据库连接和外部服务可用性
- `POST /dify/interview/create` - 创建面试记录 - 为Dify工作流创建新的面试会话记录
- `POST /dify/interview/add-qa` - 添加题目和回答 - 向面试会话中添加问题、回答和评分
- `GET /dify/interview/{user_id}/latest` - 获取最新面试信息 - 获取用户最新的面试会话状态
- `GET /dify/interview/{session_id}/summary` - 获取面试总结 - 生成面试会话的完整总结报告
- `GET /dify/interview/{user_id}/wrong-questions` - 获取用户错题列表 - 查询用户的错题记录，支持类型筛选
- `GET /dify/interview/{user_id}/wrong-question-keywords` - 获取错题关键词组合 - 为错题面试生成关键词组合

**标准API接口**:
- `POST /interview/sessions` - 创建面试会话 - 创建标准的面试会话，支持完整配置
- `GET /interview/sessions/{user_id}` - 获取用户会话列表 - 查询用户的所有面试会话记录
- `GET /interview/sessions/{session_id}/detail` - 获取会话详情 - 获取面试会话的详细信息和题目列表
- `POST /interview/sessions/{session_id}/start` - 开始面试 - 将面试会话状态设置为进行中
- `POST /interview/sessions/{session_id}/finish` - 结束面试 - 完成面试并计算最终统计数据
- `GET /interview/wrong-questions/{user_id}` - 获取用户错题（标准版） - 标准API版本的错题查询接口

#### 1. 健康检查
**URL**: `GET http://43.142.157.145:8006/health`

**功能介绍**: 检查面试记录服务状态、数据库连接和外部服务可用性

**参数**: 无

**返回格式**:
```json
{
  "status": "healthy",
  "timestamp": "2025-09-05T21:02:05.117413",
  "database_connected": true,
  "external_services": {
    "analysis_service": "available"
  },
  "stats": {
    "service_name": "interview-service",
    "port": 8006,
    "database_status": "connected"
  }
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8006/health
```

#### 2. 创建面试记录（Dify专用）
**URL**: `POST http://43.142.157.145:8006/dify/interview/create`

**功能介绍**: 为Dify工作流创建新的面试会话记录

**参数规范**:
```json
{
  "user_id": "user_001",
  "session_name": "Python开发工程师面试",
  "session_type": "resume_customized",
  "difficulty_level": "medium"
}
```

**参数说明**:
- `user_id` (字符串, 必填): 用户唯一标识符
- `session_name` (字符串, 可选): 面试会话名称
- `session_type` (字符串, 必填): 面试类型，可选值：knowledge_based/company_position/resume_customized/wrong_questions
- `difficulty_level` (字符串, 必填): 难度级别，可选值：easy/medium/hard

**返回格式**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "user_id": "user_001",
  "session_name": "Python开发工程师面试",
  "status": "created",
  "created_at": "2025-09-05T21:10:46",
  "message": "面试记录创建成功"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/create" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "session_name": "Python开发工程师面试",
    "session_type": "resume_customized",
    "difficulty_level": "medium"
  }'
```

#### 3. 添加题目和回答（Dify专用）
**URL**: `POST http://43.142.157.145:8006/dify/interview/add-qa`

**功能介绍**: 向面试会话中添加问题、回答和评分

**参数规范**:
```json
{
  "session_id": "session_20250905_133219_0a1f0199",
  "question_text": "请介绍一下Python的GIL机制及其影响。",
  "question_type": "technical",
  "question_category": "Python基础",
  "candidate_answer": "GIL是全局解释器锁...",
  "interviewer_feedback": "回答全面，体现了对语言的深入理解。",
  "overall_score": 8.5
}
```

**参数说明**:
- `session_id` (字符串, 必填): 面试会话ID
- `question_text` (字符串, 必填): 题目内容
- `question_type` (字符串, 必填): 题目类型，可选值：technical/behavioral/logical/project_based
- `question_category` (字符串, 可选): 题目分类
- `candidate_answer` (字符串, 必填): 候选人回答
- `interviewer_feedback` (字符串, 必填): 面试官反馈
- `overall_score` (数字, 必填): 综合评分，范围0-10

**返回格式**:
```json
{
  "success": true,
  "question_id": "session_20250905_133219_0a1f0199_q001",
  "session_id": "session_20250905_133219_0a1f0199",
  "status": "added",
  "message": "题目和回答添加成功"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/add-qa" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_20250905_133219_0a1f0199",
    "question_text": "请介绍一下Python的GIL机制及其影响。",
    "question_type": "technical",
    "question_category": "Python基础",
    "candidate_answer": "GIL是全局解释器锁，确保同一时间只有一个线程执行Python字节码...",
    "interviewer_feedback": "回答全面，体现了对语言的深入理解。",
    "overall_score": 8.5
  }'
```

#### 4. 获取最新面试信息（Dify专用）
**URL**: `GET http://43.142.157.145:8006/dify/interview/{user_id}/latest`

**功能介绍**: 获取用户最新的面试会话状态

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "latest_session": {
    "session_id": "session_20250905_133219_0a1f0199",
    "session_name": "Python开发工程师面试",
    "session_type": "resume_customized",
    "status": "in_progress",
    "question_count": 3,
    "average_score": 8.2
  },
  "message": "获取成功"
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8006/dify/interview/user_001/latest
```

#### 5. 获取面试总结（Dify专用）
**URL**: `GET http://43.142.157.145:8006/dify/interview/{session_id}/summary`

**功能介绍**: 生成面试会话的完整总结报告

**参数规范**:
- `session_id` (路径参数, 必填): 面试会话ID

**返回格式**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "summary": {
    "session_name": "Python开发工程师面试",
    "session_type": "resume_customized",
    "status": "completed",
    "total_questions": 5,
    "average_score": 8.4
  },
  "questions_summary": [
    {
      "question_id": "session_20250905_133219_0a1f0199_q001",
      "question_text": "请介绍一下Python的GIL机制...",
      "question_type": "technical",
      "overall_score": 8.5
    }
  ],
  "message": "获取成功"
}
```

**使用示例**:
```bash
curl http://43.142.157.145:8006/dify/interview/session_20250905_133219_0a1f0199/summary
```

#### 6. 获取用户错题列表（Dify专用）
**URL**: `GET http://43.142.157.145:8006/dify/interview/{user_id}/wrong-questions`

**功能介绍**: 查询用户的错题记录，支持类型筛选

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符
- `question_type` (查询参数, 可选): 题目类型筛选
- `limit` (查询参数, 可选): 返回数量限制，默认10，范围1-50

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "wrong_questions": [
    {
      "question_id": "session_001_q001",
      "session_id": "session_001",
      "question_text": "请解释Python的GIL机制",
      "question_type": "technical",
      "question_category": "Python基础",
      "difficulty_level": "medium",
      "candidate_answer": "用户的回答内容...",
      "interviewer_feedback": "面试官反馈...",
      "overall_score": 4.5,
      "knowledge_points": "GIL,多线程,性能优化",
      "answered_at": "2025-09-05T10:30:00",
      "reviewed_at": "2025-09-05T10:35:00"
    }
  ],
  "total": 5,
  "message": "获取成功"
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8006/dify/interview/user_001/wrong-questions?question_type=technical&limit=10"
```

#### 7. 获取错题关键词组合（Dify专用）
**URL**: `GET http://43.142.157.145:8006/dify/interview/{user_id}/wrong-question-keywords`

**功能介绍**: 为错题面试生成关键词组合

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符
- `required_count` (查询参数, 可选): 需要的关键词组数量，默认5，范围1-20
- `question_type` (查询参数, 可选): 题目类型筛选

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "keywords": [
    ["Python", "GIL", "多线程"],
    ["数据结构", "算法", "时间复杂度"],
    ["数据库", "索引", "查询优化"]
  ],
  "question_details": [
    {
      "question_id": "session_001_q001",
      "question_text": "请解释Python的GIL机制",
      "score": 4.5,
      "keywords": ["Python", "GIL", "多线程"],
      "keywords_count": 3
    }
  ],
  "total_selected_questions": 3,
  "total_wrong_questions": 15,
  "recent_pool_size": 20,
  "available_keywords_count": 8,
  "message": "从最近15道错题中随机选择3组关键词"
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8006/dify/interview/user_001/wrong-question-keywords?required_count=5&question_type=technical"
```

#### 8. 开始面试（标准API）
**URL**: `POST http://43.142.157.145:8006/interview/sessions/{session_id}/start`

**功能介绍**: 将面试会话状态设置为进行中

**参数规范**:
- `session_id` (路径参数, 必填): 面试会话ID

**返回格式**:
```json
{
  "success": true,
  "message": "面试已开始"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8006/interview/sessions/session_001/start"
```

#### 9. 结束面试（标准API）
**URL**: `POST http://43.142.157.145:8006/interview/sessions/{session_id}/finish`

**功能介绍**: 完成面试并计算最终统计数据

**参数规范**:
- `session_id` (路径参数, 必填): 面试会话ID
- `interviewer_notes` (查询参数, 可选): 面试官备注

**返回格式**:
```json
{
  "success": true,
  "message": "面试已结束",
  "actual_duration": 45
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8006/interview/sessions/session_001/finish?interviewer_notes=表现良好"
```

#### 10. 获取用户错题（标准版）
**URL**: `GET http://43.142.157.145:8006/interview/wrong-questions/{user_id}`

**功能介绍**: 标准API版本的错题查询接口

**参数规范**:
- `user_id` (路径参数, 必填): 用户唯一标识符
- `question_type` (查询参数, 可选): 题目类型筛选
- `difficulty_level` (查询参数, 可选): 题目难度筛选
- `limit` (查询参数, 可选): 返回数量限制，默认10，范围1-50

**返回格式**:
```json
{
  "success": true,
  "user_id": "user_001",
  "wrong_questions": [
    {
      "question_id": "session_001_q001",
      "session_id": "session_001",
      "question_text": "请解释Python的GIL机制",
      "question_type": "technical",
      "question_category": "Python基础",
      "difficulty_level": "medium",
      "candidate_answer": "用户的回答内容...",
      "interviewer_feedback": "面试官反馈...",
      "overall_score": 4.5,
      "knowledge_points": "GIL,多线程,性能优化",
      "answered_at": "2025-09-05T10:30:00",
      "reviewed_at": "2025-09-05T10:35:00"
    }
  ],
  "total": 5,
  "message": "获取成功"
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8006/interview/wrong-questions/user_001?question_type=technical&difficulty_level=medium&limit=10"
```

---

### 用户认证服务 (端口8007)

**基础信息**:
- 服务地址: http://43.142.157.145:8007
- 在线文档: http://43.142.157.145:8007/docs
- 主要功能: 用户注册、登录、JWT认证管理

**接口列表**:
- `GET /health` - 健康检查 - 检查用户认证服务状态和数据库连接
- `POST /auth/register` - 用户注册 - 创建新用户账户，返回JWT token
- `POST /auth/login` - 用户登录 - 验证用户凭据，返回JWT token
- `POST /auth/refresh` - 刷新Token - 使用refresh token获取新的access token
- `GET /auth/me` - 获取当前用户信息 - 基于JWT token获取用户详细信息
- `POST /auth/logout` - 用户登出 - 注销当前用户会话

#### 1. 健康检查
**URL**: `GET http://43.142.157.145:8007/health`

**功能介绍**: 检查用户认证服务状态和数据库连接

**参数**: 无

**返回格式**:
```json
{
  "status": "healthy",
  "timestamp": "2025-09-10T20:00:00.000000",
  "service": "user-auth-service",
  "version": "1.0.0",
  "database_connected": true,
  "error": null
}
```

**使用示例**:
```bash
curl "http://43.142.157.145:8007/health"
```

#### 2. 用户注册
**URL**: `POST http://43.142.157.145:8007/auth/register`

**功能介绍**: 创建新用户账户，返回JWT token

**参数规范**:
- `username` (字符串, 必填): 用户名，3-50字符，唯一
- `email` (字符串, 必填): 邮箱地址，必须是有效邮箱格式，唯一
- `password` (字符串, 必填): 密码，6-50字符

**返回格式**:
```json
{
  "success": true,
  "message": "注册成功",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "user_id": "uuid-string",
    "username": "testuser",
    "email": "test@example.com",
    "is_active": true,
    "is_verified": false,
    "created_at": "2025-09-10T20:00:00",
    "last_login_at": null
  }
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8007/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }'
```

#### 3. 用户登录
**URL**: `POST http://43.142.157.145:8007/auth/login`

**功能介绍**: 验证用户凭据，返回JWT token

**参数规范**:
- `username` (字符串, 必填): 用户名或邮箱地址
- `password` (字符串, 必填): 用户密码

**返回格式**:
```json
{
  "success": true,
  "message": "登录成功",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "user_id": "uuid-string",
    "username": "testuser",
    "email": "test@example.com",
    "is_active": true,
    "is_verified": false,
    "created_at": "2025-09-10T20:00:00",
    "last_login_at": "2025-09-10T20:30:00"
  }
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8007/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

#### 4. 刷新Token
**URL**: `POST http://43.142.157.145:8007/auth/refresh`

**功能介绍**: 使用refresh token获取新的access token

**参数规范**:
- `refresh_token` (字符串, 必填): 有效的refresh token

**返回格式**:
```json
{
  "success": true,
  "message": "Token刷新成功",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": null,
  "token_type": "bearer",
  "expires_in": 1800,
  "user": null
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8007/auth/refresh" \
  -H "Content-Type: application/json" \
  -d '{
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

#### 5. 获取当前用户信息
**URL**: `GET http://43.142.157.145:8007/auth/me`

**功能介绍**: 基于JWT token获取用户详细信息

**参数规范**:
- `Authorization` (请求头, 必填): Bearer {access_token}

**返回格式**:
```json
{
  "user_id": "uuid-string",
  "username": "testuser",
  "email": "test@example.com",
  "is_active": true,
  "is_verified": false,
  "created_at": "2025-09-10T20:00:00",
  "last_login_at": "2025-09-10T20:30:00"
}
```

**使用示例**:
```bash
curl -X GET "http://43.142.157.145:8007/auth/me" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

#### 6. 用户登出
**URL**: `POST http://43.142.157.145:8007/auth/logout`

**功能介绍**: 注销当前用户会话

**参数规范**:
- `Authorization` (请求头, 必填): Bearer {access_token}

**返回格式**:
```json
{
  "success": true,
  "message": "登出成功"
}
```

**使用示例**:
```bash
curl -X POST "http://43.142.157.145:8007/auth/logout" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### 用户认证服务特性

#### JWT Token机制
- **Access Token**: 有效期30分钟，用于API访问认证
- **Refresh Token**: 有效期7天，用于刷新access token
- **算法**: HS256加密算法
- **安全性**: bcrypt密码哈希，防止明文存储

#### 错误处理
常见错误响应：
```json
{
  "success": false,
  "message": "错误描述",
  "access_token": null,
  "refresh_token": null,
  "token_type": "bearer",
  "expires_in": null,
  "user": null
}
```

#### 集成说明
- **数据库集成**: 复用interview_analysis数据库
- **用户关联**: 通过user_id字段与candidate_profiles表关联
- **权限控制**: 支持基于JWT的API访问控制
- **服务发现**: 可被其他微服务调用进行用户验证

#### 现有用户登录说明
**迁移用户登录凭据**:
- **用户名**: 使用原candidate_profiles表中的user_id值
- **密码**: 统一设置为 `123456`
- **迁移数量**: 15个现有用户已成功迁移
- **登录示例**:
  ```bash
  curl -X POST "http://43.142.157.145:8007/auth/login" \
    -H "Content-Type: application/json" \
    -d '{
      "username": "test_user_001",
      "password": "123456"
    }'
  ```

**迁移用户列表**:
- deployment_test_user, test_complete_001, test_http_001
- test_json_storage_user, test_mysql_user, test_recovery_001
- test_remote_api, test_user_001, test_user_002, test_user_003
- test_user_010, test_xzk_001, test_xzk_user
- xzk_mysql_test_2, xzk_test_user

**安全建议**: 建议用户首次登录后修改默认密码

---

## 测试数据模板

### 用户数据
```json
{
  "user_id": "test_user_001",
  "name": "张三",
  "email": "zhangsan@example.com"
}
```

### 面试会话数据
```json
{
  "session_name": "Python开发工程师面试",
  "session_type": "resume_customized",
  "difficulty_level": "medium",
  "estimated_duration": 60
}
```

### 题目和回答数据模板

#### 技术题目
```json
{
  "question_text": "请介绍一下你最熟悉的编程语言，并说明它的优缺点。",
  "question_type": "technical",
  "question_category": "编程基础",
  "candidate_answer": "我最熟悉Python语言。优点：语法简洁、生态丰富、跨平台。缺点：执行速度慢、GIL限制、移动端支持有限。",
  "interviewer_feedback": "回答全面，体现了对语言的深入理解。",
  "overall_score": 8.5
}
```

#### 项目题目
```json
{
  "question_text": "描述一下你参与过的最有挑战性的项目。",
  "question_type": "project_based",
  "question_category": "项目经验",
  "candidate_answer": "参与分布式系统项目，解决数据一致性问题，使用Redis分布式锁和RabbitMQ消息队列。",
  "interviewer_feedback": "技术方案合理，展现了良好的系统设计能力。",
  "overall_score": 9.0
}
```

#### 行为题目
```json
{
  "question_text": "你如何处理工作中的压力和紧急情况？",
  "question_type": "behavioral",
  "question_category": "软技能",
  "candidate_answer": "分析优先级，制定计划，保持冷静，及时沟通，注重团队协作。",
  "interviewer_feedback": "体现了良好的抗压能力，可提供更具体实例。",
  "overall_score": 7.5
}
```

---

## 数据类型说明

### 枚举类型

#### SessionType (面试类型)
- `knowledge_based`: 自选知识点面试
- `company_position`: 自选公司岗位面试
- `resume_customized`: 个人简历定制面试
- `wrong_questions`: 错题面试

#### DifficultyLevel (难度级别)
- `easy`: 简单
- `medium`: 中等
- `hard`: 困难

#### QuestionType (题目类型)
- `technical`: 技术题
- `behavioral`: 行为题
- `logical`: 逻辑题
- `project_based`: 项目题

#### SessionStatus (会话状态)
- `pending`: 待开始
- `in_progress`: 进行中
- `completed`: 已完成
- `cancelled`: 已取消

---

## 错误处理

### 常见错误码
- `SESSION_NOT_FOUND`: 面试会话不存在
- `USER_NOT_FOUND`: 用户不存在
- `INVALID_SCORE`: 分数范围错误（应为0-10）
- `INVALID_SESSION_STATUS`: 会话状态错误
- `DATABASE_ERROR`: 数据库操作失败
- `EXTERNAL_SERVICE_ERROR`: 外部服务调用失败

### 错误响应格式
```json
{
  "success": false,
  "error_code": "BUSINESS_ERROR_CODE",
  "message": "错误描述",
  "details": "详细错误信息"
}
```

---

## 性能指标和注意事项

### 响应时间基准
- 健康检查：< 100ms
- 创建面试记录：< 500ms
- 添加题目回答：< 300ms
- 获取面试信息：< 200ms
- 获取面试总结：< 400ms

### 重要注意事项
1. **分数范围**: 所有评分字段范围为0-10，支持小数
2. **字符编码**: 所有文本内容使用UTF-8编码
3. **会话ID**: 自动生成，格式为`session_YYYYMMDD_HHMMSS_随机字符`
4. **题目ID**: 自动生成，格式为`{session_id}_q{序号}`
5. **数据格式**: 所有时间字段使用ISO 8601格式
6. **并发限制**: 支持并发请求10个/秒，数据库连接池10个连接

### 部署验证清单
- [ ] 所有服务正常启动
- [ ] 健康检查接口响应正常
- [ ] 数据库连接正常
- [ ] 外部服务依赖可用
- [ ] API接口功能正常
- [ ] 测试数据创建成功
- [ ] 日志记录正常
- [ ] 性能指标达标

---

## 更新日志

### v1.1.0 (2025-09-10)
- **新增用户认证服务**: 完整的用户注册、登录、JWT认证系统
- **微服务架构扩展**: 新增端口8007的用户认证服务
- **数据库设计优化**: 在interview_analysis数据库中新增users表
- **用户数据迁移**: 成功迁移15个现有用户到认证系统，默认密码123456
- **JWT双token机制**: 实现access token和refresh token认证方案
- **密码安全加强**: 使用bcrypt进行密码哈希存储，防彩虹表攻击
- **表关联设计**: users表与candidate_profiles表通过user_id字段关联
- **API接口完善**: 提供完整的用户管理API接口
- **迁移工具开发**: 创建自动化数据迁移脚本和验证工具
- **文档更新**: 更新项目架构文档和API使用指南，新增密码加密说明
- **集成测试**: 所有认证接口测试通过，迁移用户登录验证100%成功

### v1.0.1 (2025-09-09)
- **错题集功能修复**: 解决knowledge_points字段数据类型不匹配问题
- **数据库优化**: 将knowledge_points字段从JSON类型改为TEXT类型，统一数据格式
- **代码简化**: 移除复杂的类型转换逻辑，提升性能和维护性
- **测试验证**: 错题查询API测试通过率100%，响应时间6-9ms
- **文档更新**: 同步更新API文档和在线文档服务

### v1.0.0 (2025-09-05)
- 初始版本发布
- 完成服务器部署配置修改
- 支持Dify专用接口
- 支持标准面试管理接口
- 完整的数据模型和错误处理
- MySQL数据库支持
- 健康检查和监控功能
- 完整的API文档和使用示例

---

## 联系信息

如有问题或需要技术支持，请联系开发团队。

**项目路径**: `/home/ubuntu/workspace/project/GUET-InduEdu/interviewer/test/`
**文档位置**: `project_document/[000]AI智能面试官项目完整指南.md`
