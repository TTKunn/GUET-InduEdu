# [003]完整服务链路测试详细计划

## 测试目标
对AI面试官智能体项目的三个微服务进行完整的服务链路测试，验证：
1. PDF解析服务 (端口8003)
2. 简历分析服务 (端口8004) 
3. 向量存储服务 (端口8005)
4. 使用xzk.pdf进行端到端测试

## 前置条件检查

### 必需的环境配置
1. **智谱AI API Key** - 用于LLM服务和嵌入模型
2. **MySQL数据库连接** - 已配置为43.142.157.145:3306/interview_analysis
3. **Milvus向量数据库** - 默认localhost:19530
4. **Python依赖包** - 各服务的requirements.txt

### 当前缺失的配置
- 各服务目录下缺少.env文件
- 需要智谱AI API Key配置
- 需要确认Milvus服务状态

## 测试计划详细步骤

### 阶段1: 环境准备 (预计15分钟)
1. **创建环境配置文件**
   - 为每个服务创建.env文件
   - 配置智谱AI API Key
   - 验证MySQL连接配置

2. **安装依赖包**
   - 检查Python环境
   - 安装各服务的requirements.txt
   - 验证关键包的可用性

3. **验证外部依赖**
   - 测试MySQL数据库连接
   - 检查Milvus服务状态
   - 验证智谱AI API可用性

### 阶段2: 服务启动 (预计10分钟)
1. **启动PDF解析服务** (端口8003)
   - 进入interviewer/test/pdf-parser-service目录
   - 执行python main.py
   - 验证/health接口响应

2. **启动向量存储服务** (端口8005)
   - 进入interviewer/test/vector-storage-service目录
   - 执行python main.py
   - 验证/health接口响应

3. **启动简历分析服务** (端口8004)
   - 进入interviewer/test/analysis-service目录
   - 执行python main.py
   - 验证/health接口响应

### 阶段3: 单服务功能测试 (预计20分钟)
1. **PDF解析服务测试**
   - 测试/parse-text接口
   - 使用xzk.pdf文件
   - 验证文本提取结果

2. **向量存储服务测试**
   - 测试向量存储功能
   - 测试向量检索功能
   - 验证嵌入模型工作正常

3. **简历分析服务测试**
   - 测试/parse-pdf接口（本地解析）
   - 验证LLM服务连接
   - 测试MySQL数据库操作

### 阶段4: 服务链路集成测试 (预计25分钟)
1. **完整简历分析流程**
   - 调用/analyze接口上传xzk.pdf
   - 验证PDF解析→LLM提取→数据库存储的完整链路
   - 检查返回的结构化信息

2. **关键词提取测试**
   - 调用/keywords接口
   - 验证技术技能提取
   - 验证项目关键词提取

3. **Dify适配接口测试**
   - 调用/keywords/grouped/{user_id}接口
   - 验证Dify工作流所需的数据格式

### 阶段5: 错误处理和边界测试 (预计15分钟)
1. **服务降级测试**
   - 模拟PDF解析服务不可用
   - 验证本地解析备用方案
   - 测试错误处理机制

2. **数据验证测试**
   - 测试无效文件上传
   - 测试重复用户ID处理
   - 验证数据完整性

### 阶段6: 性能和稳定性测试 (预计10分钟)
1. **并发测试**
   - 同时处理多个PDF文件
   - 验证服务稳定性

2. **资源使用监控**
   - 监控内存使用
   - 检查日志输出
   - 验证数据库连接池

## 验收标准

### 功能验收
- [ ] 所有三个服务成功启动并响应健康检查
- [ ] PDF解析服务能正确提取xzk.pdf的文本内容
- [ ] 简历分析服务能完成结构化信息提取
- [ ] 关键词提取功能正常工作
- [ ] 数据成功存储到MySQL数据库
- [ ] 向量存储和检索功能正常

### 性能验收
- [ ] 单个PDF文件处理时间 < 30秒
- [ ] 服务响应时间 < 5秒
- [ ] 内存使用稳定，无明显泄漏

### 稳定性验收
- [ ] 服务能连续运行30分钟无崩溃
- [ ] 错误处理机制正常工作
- [ ] 日志记录完整且有意义

## 风险预案

### 高风险项
1. **智谱AI API Key缺失**
   - 风险：LLM服务无法工作
   - 预案：请求用户提供API Key

2. **Milvus服务不可用**
   - 风险：向量存储服务无法启动
   - 预案：跳过向量存储测试，重点测试核心分析功能

3. **MySQL连接失败**
   - 风险：数据存储功能无法工作
   - 预案：检查网络连接和数据库配置

### 中风险项
1. **依赖包版本冲突**
   - 预案：使用虚拟环境隔离
   
2. **端口占用冲突**
   - 预案：修改配置文件中的端口号

## 测试输出要求

### 必需的测试输出
1. **服务启动日志** - 每个服务的完整启动过程
2. **健康检查响应** - 所有/health接口的返回结果
3. **PDF解析结果** - xzk.pdf的完整文本提取内容
4. **结构化提取结果** - LLM提取的JSON格式数据
5. **数据库存储验证** - 数据库中的实际存储记录
6. **错误日志** - 任何出现的错误和警告信息

### 测试报告格式
- 按阶段组织测试结果
- 包含原始输出和分析说明
- 标明通过/失败状态
- 记录处理时间和性能指标

## 清理计划
测试完成后需要清理的临时文件：
- 测试过程中生成的日志文件
- 临时的环境配置文件（如果创建）
- 数据库中的测试数据（可选保留）

---
**创建时间**: 2025-01-09
**预计执行时间**: 95分钟
**责任人**: AI Assistant
