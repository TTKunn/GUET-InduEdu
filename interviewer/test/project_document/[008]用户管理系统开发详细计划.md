# [008]用户管理系统开发详细计划

## 📋 项目概述

**项目名称**: AI智能面试官项目 - 用户管理系统开发  
**创建时间**: 2025-01-10  
**技术方案**: 方案二（独立认证表方案）  
**服务端口**: 8007  
**开发规范**: RIPER-5工作流 + 现有项目架构规范  

## 🎯 项目目标

为AI智能面试官项目添加完整的用户管理系统，实现：
- 用户注册功能（用户名、邮箱、密码）
- 用户登录功能（JWT token认证）
- 用户信息管理
- 与现有candidate_profiles表的无缝集成

## 🏗️ 技术架构

### 服务架构
- **服务名称**: user-auth-service
- **部署端口**: 8007
- **技术栈**: FastAPI + SQLAlchemy + MySQL + JWT + bcrypt
- **集成方式**: 通过user_id字段与现有系统松耦合集成

### 数据库设计
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '自增主键',
    user_id VARCHAR(100) UNIQUE NOT NULL COMMENT '用户唯一标识，关联candidate_profiles',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT '邮箱',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    is_active BOOLEAN DEFAULT TRUE COMMENT '账户状态',
    is_verified BOOLEAN DEFAULT FALSE COMMENT '邮箱验证状态',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
);
```

### API接口设计
- POST /auth/register - 用户注册
- POST /auth/login - 用户登录
- POST /auth/refresh - 刷新token
- GET /auth/me - 获取当前用户信息
- POST /auth/logout - 用户登出
- GET /health - 健康检查

## 📝 详细任务计划

### 任务1: 创建用户认证服务基础架构
**预估时间**: 1小时  
**依赖**: 无  
**目标**: 建立服务目录结构和基础文件框架

**实施步骤**:
1. 在interviewer/test/目录下创建user-auth-service文件夹
2. 创建基础文件：main.py, config.py, models.py, database.py, auth_service.py
3. 创建auth子目录，包含认证相关模块
4. 创建requirements.txt, start.sh, .env文件
5. 创建logs目录

**验收标准**: 目录结构完整，基础文件存在

### 任务2: 配置管理模块开发
**预估时间**: 1.5小时  
**依赖**: 任务1  
**目标**: 实现配置管理，复用现有配置模式

**实施步骤**:
1. 复用现有服务的配置管理模式
2. 添加JWT相关配置项
3. 实现配置验证和信息显示功能
4. 配置数据库连接参数

**验收标准**: 配置模块完成，配置验证功能正常

### 任务3: 数据库模型设计与实现
**预估时间**: 2小时  
**依赖**: 任务2  
**目标**: 设计users表模型和Pydantic模型

**实施步骤**:
1. 创建User SQLAlchemy模型
2. 创建Pydantic请求响应模型
3. 设置合适的索引和约束
4. 确保与现有模型设计一致

**验收标准**: 数据库模型设计完成，字段设计合理

### 任务4: 数据库操作服务开发
**预估时间**: 2.5小时  
**依赖**: 任务3  
**目标**: 实现数据库CRUD操作

**实施步骤**:
1. 复用现有数据库连接模式
2. 实现用户CRUD操作
3. 实现用户状态管理
4. 添加数据库表自动创建功能

**验收标准**: 数据库操作服务完成，CRUD功能正常

### 任务5: JWT认证处理器开发
**预估时间**: 3小时  
**依赖**: 任务4  
**目标**: 实现JWT token处理和密码哈希

**实施步骤**:
1. 实现JWT token生成和验证
2. 实现密码哈希处理（bcrypt）
3. 实现JWT Bearer中间件
4. 添加token刷新逻辑

**验收标准**: JWT认证功能完成，安全性验证通过

### 任务6: 认证业务逻辑服务开发
**预估时间**: 2.5小时  
**依赖**: 任务5  
**目标**: 整合认证业务逻辑

**实施步骤**:
1. 实现用户注册业务逻辑
2. 实现用户登录业务逻辑
3. 实现token刷新和用户信息获取
4. 添加完整的错误处理

**验收标准**: 认证业务逻辑完成，流程完整

### 任务7: FastAPI应用和路由开发
**预估时间**: 2小时  
**依赖**: 任务6  
**目标**: 实现API接口

**实施步骤**:
1. 创建FastAPI应用
2. 实现认证相关API路由
3. 实现健康检查接口
4. 添加全局异常处理

**验收标准**: API接口完成，路由正常工作

### 任务8: 依赖管理和启动脚本开发
**预估时间**: 1小时  
**依赖**: 任务7  
**目标**: 完善部署配置

**实施步骤**:
1. 创建requirements.txt依赖文件
2. 创建start.sh启动脚本
3. 配置.env环境文件
4. 添加服务健康检查

**验收标准**: 服务可正常启动，部署配置完整

### 任务9: 服务集成测试和文档完善
**预估时间**: 2小时  
**依赖**: 任务8  
**目标**: 全面测试和文档完善

**实施步骤**:
1. 进行完整的功能测试
2. 验证与现有系统的集成
3. 检查API文档生成
4. 完善使用说明

**验收标准**: 所有功能测试通过，文档完整

## 📊 项目进度跟踪

- [ ] 任务1: 创建用户认证服务基础架构
- [ ] 任务2: 配置管理模块开发
- [ ] 任务3: 数据库模型设计与实现
- [ ] 任务4: 数据库操作服务开发
- [ ] 任务5: JWT认证处理器开发
- [ ] 任务6: 认证业务逻辑服务开发
- [ ] 任务7: FastAPI应用和路由开发
- [ ] 任务8: 依赖管理和启动脚本开发
- [ ] 任务9: 服务集成测试和文档完善

## 🔧 技术依赖

```
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
pymysql==1.1.0
pydantic==2.5.0
python-dotenv==1.0.0
PyJWT==2.8.0
bcrypt==4.0.1
python-multipart==0.0.6
httpx==0.25.2
```

## 📋 验收标准

1. **功能完整性**: 用户注册、登录、token管理功能完整
2. **架构一致性**: 完全遵循现有项目架构和代码规范
3. **安全性**: JWT + bcrypt安全方案实施到位
4. **集成性**: 与现有candidate_profiles表正常集成
5. **可维护性**: 代码结构清晰，文档完整

## 📅 预计完成时间

**总预估时间**: 17.5小时  
**建议完成周期**: 3-4个工作日  

---

## 🎉 项目完成状态

### 任务执行状态
- [x] 任务1：用户认证服务基础架构搭建 ✅ 已完成
- [x] 任务2：配置管理模块开发 ✅ 已完成
- [x] 任务3：数据库模型设计与实现 ✅ 已完成
- [x] 任务4：数据库操作服务开发 ✅ 已完成
- [x] 任务5：JWT认证处理器开发 ✅ 已完成
- [x] 任务6：认证业务逻辑服务开发 ✅ 已完成
- [x] 任务7：FastAPI应用和路由开发 ✅ 已完成
- [x] 任务8：依赖管理和启动脚本开发 ✅ 已完成
- [x] 任务9：服务集成测试和文档完成 ✅ 已完成

### 实现功能
1. **用户注册功能** - 支持用户名、邮箱、密码注册，自动生成UUID
2. **用户登录功能** - 支持用户名或邮箱登录，返回JWT token
3. **Token管理** - 支持access token和refresh token双token机制
4. **用户信息获取** - 基于JWT token获取当前用户信息
5. **用户登出功能** - 支持用户登出操作
6. **健康检查** - 提供服务状态和数据库连接检查

### 技术特性
- **JWT认证** - 使用PyJWT实现安全的token认证
- **密码加密** - 使用bcrypt进行密码哈希存储
- **数据库ORM** - 使用SQLAlchemy进行数据库操作
- **API文档** - 自动生成Swagger/OpenAPI文档
- **配置管理** - 支持环境变量和.env文件配置
- **错误处理** - 完善的异常处理和日志记录
- **启动脚本** - 提供便捷的服务启动和停止脚本

### 测试验证
- ✅ 用户注册接口测试通过
- ✅ 用户登录接口测试通过
- ✅ Token刷新接口测试通过
- ✅ 获取用户信息接口测试通过
- ✅ 用户登出接口测试通过
- ✅ 健康检查接口测试通过
- ✅ 启动脚本测试通过
- ✅ 停止脚本测试通过

### 部署信息
- **服务端口**: 8007
- **API文档**: http://localhost:8007/docs
- **健康检查**: http://localhost:8007/health
- **数据库**: 复用现有MySQL数据库 (interview_analysis)
- **启动方式**: `./start.sh` 或 `python3 main.py`

---

**文档状态**: ✅ 项目开发完成
**当前阶段**: Review（审查）阶段
**负责人**: AI开发助手
**项目完成时间**: 2025-09-10 20:42
**最后更新**: 2025-09-10
