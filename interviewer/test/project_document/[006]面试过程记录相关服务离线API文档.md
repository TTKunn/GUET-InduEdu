# [006]面试过程记录相关服务离线API文档

## 文档概述
本文档提供面试过程记录相关服务的完整API接口说明，包括面试记录服务、简历分析服务等核心服务的API规范。适用于服务未启动时的离线查阅。

## 服务列表

### 1. 面试记录服务 (Interview Service)
- **端口**: 8006
- **基础URL**: http://43.142.157.145:8006
- **主要功能**: 面试会话管理、题目记录、评分统计
- **在线文档**: http://43.142.157.145:8006/docs

### 2. 简历分析服务 (Analysis Service)  
- **端口**: 8004
- **基础URL**: http://43.142.157.145:8004
- **主要功能**: 简历内容分析、关键信息提取
- **在线文档**: http://43.142.157.145:8004/docs

### 3. PDF解析服务 (PDF Parser Service)
- **端口**: 8003  
- **基础URL**: http://43.142.157.145:8003
- **主要功能**: PDF文件解析、文本提取
- **在线文档**: http://43.142.157.145:8003/docs

### 4. 向量存储服务 (Vector Storage Service)
- **端口**: 8005
- **基础URL**: http://43.142.157.145:8005  
- **主要功能**: 向量化存储、语义搜索
- **在线文档**: http://43.142.157.145:8005/docs

---

## 面试记录服务API详细说明

### 基本信息
- **服务名称**: Interview Service
- **版本**: 1.0.0
- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **字符编码**: UTF-8

### 通用响应格式

#### 成功响应
```json
{
  "success": true,
  "data": {},
  "message": "操作成功"
}
```

#### 错误响应
```json
{
  "success": false,
  "error_code": "ERROR_CODE",
  "message": "错误描述",
  "details": "详细错误信息"
}
```

### API接口列表

#### 1. 健康检查
**GET /health**

**描述**: 检查服务运行状态和依赖服务连接情况

**请求参数**: 无

**响应示例**:
```json
{
  "status": "healthy",
  "timestamp": "2025-09-05T13:30:44.523900",
  "database_connected": true,
  "external_services": {
    "analysis_service": "available"
  },
  "stats": {
    "service_name": "interview-service",
    "port": 8006,
    "database_status": "connected"
  }
}
```

**字段说明**:
- `status`: 服务状态，可选值: `healthy`, `unhealthy`, `error`
- `timestamp`: 检查时间戳，ISO 8601格式
- `database_connected`: 数据库连接状态，布尔值
- `external_services`: 外部服务状态对象
- `stats`: 服务统计信息对象

#### 2. 创建面试记录（Dify专用）
**POST /dify/interview/create**

**描述**: 为Dify工作流创建新的面试记录会话

**请求头**:
```
Content-Type: application/json
```

**请求体**:
```json
{
  "user_id": "user_001",
  "session_name": "Python开发工程师面试",
  "difficulty_level": "medium"
}
```

**字段说明**:
- `user_id` (string, 必填): 用户唯一标识符，长度1-100字符
- `session_name` (string, 可选): 面试会话名称，长度1-200字符，可为空
- `difficulty_level` (string, 可选): 面试难度级别
  - 可选值: `easy`, `medium`, `hard`

**响应示例**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "user_id": "user_001",
  "session_name": "Python开发工程师面试",
  "status": "pending",
  "created_at": "2025-09-05T21:10:46",
  "message": "面试记录创建成功"
}
```

**响应字段说明**:
- `session_id`: 自动生成的会话ID，格式: `session_YYYYMMDD_HHMMSS_随机字符`
- `status`: 会话状态，创建时为"pending"
- `created_at`: 创建时间，ISO 8601格式

#### 3. 添加题目和回答（Dify专用）
**POST /dify/interview/add-qa**

**描述**: 向指定面试会话添加题目和候选人回答记录

**请求头**:
```
Content-Type: application/json
```

**请求体**:
```json
{
  "session_id": "session_20250905_133219_0a1f0199",
  "question_text": "请介绍一下你最熟悉的编程语言，并说明它的优缺点。",
  "question_type": "technical",
  "question_category": "编程基础",
  "candidate_answer": "我最熟悉Python语言。优点：语法简洁、生态丰富、跨平台。缺点：执行速度慢、GIL限制、移动端支持有限。",
  "interviewer_feedback": "回答全面，体现了对语言的深入理解。",
  "overall_score": 8.5
}
```

**字段说明**:
- `session_id` (string, 必填): 面试会话ID
- `question_text` (string, 必填): 题目内容，长度1-2000字符
- `question_type` (string, 必填): 题目类型
  - 可选值: `technical`, `behavioral`, `logical`, `project_based`
- `question_category` (string, 可选): 题目分类，长度1-100字符
- `candidate_answer` (string, 必填): 候选人回答，长度1-5000字符
- `interviewer_feedback` (string, 必填): 面试官反馈，长度1-2000字符
- `overall_score` (number, 必填): 综合评分，范围0-10，支持小数

**响应示例**:
```json
{
  "success": true,
  "question_id": "session_20250905_133219_0a1f0199_q001",
  "session_id": "session_20250905_133219_0a1f0199",
  "status": "added",
  "message": "题目和回答添加成功"
}
```

**响应字段说明**:
- `question_id`: 自动生成的题目ID，格式: `{session_id}_q{序号}`
- `status`: 添加状态，成功时为"added"

#### 4. 获取最新面试信息（Dify专用）
**GET /dify/interview/{user_id}/latest**

**描述**: 获取指定用户的最新面试会话信息

**路径参数**:
- `user_id` (string): 用户ID

**响应示例**:
```json
{
  "success": true,
  "user_id": "user_001",
  "latest_session": {
    "session_id": "session_20250905_133219_0a1f0199",
    "session_name": "Python开发工程师面试",
    "status": "pending",
    "created_at": "2025-09-05T13:32:19"
  },
  "message": "获取成功"
}
```

**字段说明**:
- `latest_session`: 最新会话信息对象，如果用户没有会话则为null
- `status`: 会话状态，可选值: `pending`, `in_progress`, `completed`, `cancelled`

#### 5. 获取面试总结（Dify专用）
**GET /dify/interview/{session_id}/summary**

**描述**: 获取指定面试会话的统计总结信息

**路径参数**:
- `session_id` (string): 面试会话ID

**响应示例**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "summary": {
    "total_questions": 3,
    "completed_questions": 3,
    "average_score": 8.3,
    "session_status": "pending",
    "start_time": null,
    "end_time": null,
    "duration": null
  },
  "questions_summary": [
    {
      "question_id": "session_20250905_133219_0a1f0199_q001",
      "question_text": "请介绍一下你最熟悉的编程语言...",
      "question_type": "technical",
      "overall_score": 8.5
    }
  ],
  "message": "获取成功"
}
```

**字段说明**:
- `total_questions`: 总题目数量
- `completed_questions`: 已完成题目数量
- `average_score`: 平均分数，保留1位小数
- `duration`: 面试时长（分钟），未开始时为null
- `questions_summary`: 题目摘要列表

#### 6. 创建面试会话（标准API）
**POST /interview/sessions**

**描述**: 创建新的面试会话（标准API接口）

**请求体**:
```json
{
  "user_id": "user_001",
  "session_name": "Python开发工程师面试",
  "difficulty_level": "medium",
  "estimated_duration": 60
}
```

**字段说明**:
- `user_id` (string, 必填): 用户唯一标识符
- `session_name` (string, 可选): 面试会话名称
- `difficulty_level` (string, 可选): 面试难度级别
- `estimated_duration` (number, 可选): 预计面试时长（分钟），范围10-300，默认60

**响应示例**:
```json
{
  "success": true,
  "session_id": "session_20250905_133219_0a1f0199",
  "data": {
    "session_id": "session_20250905_133219_0a1f0199",
    "user_id": "user_001",
    "session_name": "Python开发工程师面试",
    "status": "pending",
    "created_at": "2025-09-05T13:32:19"
  },
  "message": "创建成功"
}
```

#### 7. 获取用户会话列表（标准API）
**GET /interview/sessions/{user_id}**

**描述**: 获取指定用户的面试会话列表

**路径参数**:
- `user_id` (string): 用户ID

**查询参数**:
- `status` (string, 可选): 过滤状态
- `limit` (number, 可选): 返回数量限制，范围1-50，默认10

**响应示例**:
```json
{
  "success": true,
  "user_id": "user_001",
  "sessions": [
    {
      "session_id": "session_20250905_133219_0a1f0199",
      "session_name": "Python开发工程师面试",
      "status": "pending",
      "created_at": "2025-09-05T13:32:19",
      "total_questions": 3,
      "average_score": 8.3
    }
  ],
  "total": 1,
  "message": "获取成功"
}
```

---

## 数据类型和枚举说明

### 面试相关枚举

#### SessionType (面试类型)
- `knowledge_based`: 自选知识点面试 - 根据特定知识点进行面试
- `company_position`: 自选公司岗位面试 - 针对特定公司岗位的面试
- `resume_customized`: 个人简历定制面试 - 基于个人简历内容的定制化面试
- `wrong_questions`: 错题面试 - 针对之前错误回答的题目进行复习面试

#### DifficultyLevel (难度级别)
- `easy`: 简单 - 适合初级候选人
- `medium`: 中等 - 适合中级候选人
- `hard`: 困难 - 适合高级候选人

#### QuestionType (题目类型)
- `technical`: 技术题 - 考察专业技术能力
- `behavioral`: 行为题 - 考察行为和软技能
- `logical`: 逻辑题 - 考察逻辑思维能力
- `project_based`: 项目题 - 考察项目经验和实践能力

#### SessionStatus (会话状态)
- `pending`: 待开始 - 会话已创建但未开始
- `in_progress`: 进行中 - 面试正在进行
- `completed`: 已完成 - 面试已结束
- `cancelled`: 已取消 - 会话被取消

### 数据格式规范

#### 时间格式
所有时间字段使用ISO 8601格式：`YYYY-MM-DDTHH:MM:SS`
示例：`2025-09-05T13:32:19`

#### ID格式规范
- **会话ID**: `session_YYYYMMDD_HHMMSS_随机字符`
- **题目ID**: `{session_id}_q{序号}`
- **用户ID**: 自定义字符串，建议使用有意义的标识符

#### 分数规范
- **范围**: 0-10分
- **精度**: 支持小数，建议保留1位小数
- **示例**: 8.5, 9.0, 7.2

#### 字符长度限制
- **用户ID**: 1-100字符
- **会话名称**: 1-200字符
- **题目内容**: 1-2000字符
- **候选人回答**: 1-5000字符
- **面试官反馈**: 1-2000字符
- **题目分类**: 1-100字符

---

## 错误码说明

### HTTP状态码
- `200`: 请求成功
- `400`: 请求参数错误
- `401`: 未授权访问
- `404`: 资源不存在
- `500`: 服务器内部错误

### 业务错误码

#### 面试记录服务错误码
- `SESSION_NOT_FOUND`: 面试会话不存在
- `USER_NOT_FOUND`: 用户不存在
- `INVALID_SCORE`: 分数范围错误（应为0-10）
- `INVALID_SESSION_STATUS`: 会话状态错误
- `SESSION_ALREADY_STARTED`: 会话已经开始
- `SESSION_ALREADY_FINISHED`: 会话已经结束
- `QUESTION_NOT_FOUND`: 题目不存在
- `DUPLICATE_QUESTION`: 重复的题目

#### 简历分析服务错误码
- `FILE_TOO_LARGE`: 文件过大（超过10MB）
- `INVALID_FILE_FORMAT`: 文件格式不支持
- `PDF_PARSE_ERROR`: PDF解析失败
- `LLM_SERVICE_ERROR`: LLM服务调用失败
- `EXTRACTION_FAILED`: 信息提取失败

#### 通用错误码
- `DATABASE_ERROR`: 数据库操作失败
- `EXTERNAL_SERVICE_ERROR`: 外部服务调用失败
- `VALIDATION_ERROR`: 数据验证失败
- `TIMEOUT_ERROR`: 请求超时

---

## 使用示例

### 完整面试流程示例

#### 1. 创建面试记录
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/create" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "candidate_001",
    "session_name": "Python开发工程师面试",
    "session_type": "resume_customized",
    "difficulty_level": "medium"
  }'
```

#### 2. 添加技术题目
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/add-qa" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_20250905_133219_0a1f0199",
    "question_text": "请解释Python的装饰器机制，并给出一个实际应用示例。",
    "question_type": "technical",
    "question_category": "Python高级特性",
    "candidate_answer": "装饰器是Python的一种设计模式，允许在不修改原函数代码的情况下扩展其功能。实现原理是利用函数作为一等公民的特性...",
    "interviewer_feedback": "理解深入，能够结合实际应用场景，回答质量很高。",
    "overall_score": 9.0
  }'
```

#### 3. 添加项目经验题目
```bash
curl -X POST "http://43.142.157.145:8006/dify/interview/add-qa" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_20250905_133219_0a1f0199",
    "question_text": "描述一个你负责的复杂项目，遇到的主要技术挑战是什么？",
    "question_type": "project_based",
    "question_category": "项目经验",
    "candidate_answer": "我负责开发一个高并发的电商推荐系统，主要挑战是实时性和准确性的平衡。我们采用了流式计算架构...",
    "interviewer_feedback": "项目经验丰富，技术方案设计合理，具备解决复杂问题的能力。",
    "overall_score": 8.5
  }'
```

#### 4. 获取面试总结
```bash
curl -X GET "http://43.142.157.145:8006/dify/interview/session_20250905_133219_0a1f0199/summary"
```

### Python SDK示例

```python
import requests
import json
from typing import Dict, Any

class InterviewAPI:
    def __init__(self, base_url: str = "http://43.142.157.145:8006"):
        self.base_url = base_url
        self.session = requests.Session()
        self.session.headers.update({"Content-Type": "application/json"})

    def create_interview(self, user_id: str, session_name: str,
                        session_type: str = "resume_customized",
                        difficulty_level: str = "medium") -> Dict[str, Any]:
        """创建面试记录"""
        url = f"{self.base_url}/dify/interview/create"
        data = {
            "user_id": user_id,
            "session_name": session_name,
            "session_type": session_type,
            "difficulty_level": difficulty_level
        }
        response = self.session.post(url, json=data)
        return response.json()

    def add_question_answer(self, session_id: str, question_text: str,
                           question_type: str, candidate_answer: str,
                           interviewer_feedback: str, overall_score: float,
                           question_category: str = None) -> Dict[str, Any]:
        """添加题目和回答"""
        url = f"{self.base_url}/dify/interview/add-qa"
        data = {
            "session_id": session_id,
            "question_text": question_text,
            "question_type": question_type,
            "candidate_answer": candidate_answer,
            "interviewer_feedback": interviewer_feedback,
            "overall_score": overall_score
        }
        if question_category:
            data["question_category"] = question_category

        response = self.session.post(url, json=data)
        return response.json()

    def get_interview_summary(self, session_id: str) -> Dict[str, Any]:
        """获取面试总结"""
        url = f"{self.base_url}/dify/interview/{session_id}/summary"
        response = self.session.get(url)
        return response.json()

    def get_latest_interview(self, user_id: str) -> Dict[str, Any]:
        """获取最新面试信息"""
        url = f"{self.base_url}/dify/interview/{user_id}/latest"
        response = self.session.get(url)
        return response.json()

# 使用示例
if __name__ == "__main__":
    api = InterviewAPI()

    # 创建面试
    result = api.create_interview(
        user_id="python_expert_001",
        session_name="Python高级工程师技术面试",
        session_type="resume_customized",
        difficulty_level="hard"
    )

    session_id = result["session_id"]
    print(f"面试会话创建成功: {session_id}")

    # 添加题目
    api.add_question_answer(
        session_id=session_id,
        question_text="请设计一个高并发的缓存系统，说明你的设计思路。",
        question_type="technical",
        question_category="系统设计",
        candidate_answer="我会采用分层缓存架构，包括本地缓存、分布式缓存和数据库缓存...",
        interviewer_feedback="设计思路清晰，考虑了高并发场景下的各种问题。",
        overall_score=9.2
    )

    # 获取总结
    summary = api.get_interview_summary(session_id)
    print(f"面试总结: {summary}")
```

---

## 性能指标和限制

### 响应时间基准
- **健康检查**: < 100ms
- **创建面试记录**: < 500ms
- **添加题目回答**: < 300ms
- **获取面试信息**: < 200ms
- **获取面试总结**: < 400ms
- **简历分析**: < 60s（包含LLM处理时间）

### 并发限制
- **每秒请求数**: 10 QPS
- **数据库连接池**: 10个连接
- **文件上传大小**: 最大10MB
- **请求超时**: 30秒（简历分析为60秒）

### 数据限制
- **用户会话数**: 每用户最多100个活跃会话
- **题目数量**: 每会话最多50个题目
- **存储时间**: 数据保留1年

---

## 注意事项

1. **数据安全**: 所有敏感信息需要妥善保护，建议启用HTTPS
2. **错误处理**: 客户端应实现适当的错误处理和重试机制
3. **版本兼容**: API版本更新时会保持向后兼容
4. **监控告警**: 建议对关键接口设置监控和告警
5. **备份恢复**: 重要数据需要定期备份

---

## 更新日志

### v1.0.0 (2025-09-05)
- 初始版本发布
- 支持面试记录管理功能
- 支持Dify专用接口
- 支持标准API接口
- 完整的错误处理机制
- 详细的API文档和使用示例
